(function(){const oe=document.createElement("link").relList;if(oe&&oe.supports&&oe.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))j(a);new MutationObserver(a=>{for(const P of a)if(P.type==="childList")for(const q of P.addedNodes)q.tagName==="LINK"&&q.rel==="modulepreload"&&j(q)}).observe(document,{childList:!0,subtree:!0});function ee(a){const P={};return a.integrity&&(P.integrity=a.integrity),a.referrerPolicy&&(P.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?P.credentials="include":a.crossOrigin==="anonymous"?P.credentials="omit":P.credentials="same-origin",P}function j(a){if(a.ep)return;a.ep=!0;const P=ee(a);fetch(a.href,P)}})();function an(_,oe,ee,j){const a=document.createElement("div");a.className="search-results",_.parentNode.style.position="relative",_.parentNode.appendChild(a);async function P(q){if(a.innerHTML="",!!q)try{const{hits:H}=await oe.search(q,{hitsPerPage:5});H.forEach(F=>{const U=document.createElement("div");U.className="search-result";const ue=F.name||`Song #${F.token_id}`;U.textContent=ue,U.addEventListener("click",()=>{a.innerHTML="",_.value="",ee&&ee(parseInt(F.objectID,10))}),a.appendChild(U)})}catch(H){console.error("Search error",H)}}_.addEventListener("input",q=>{P(q.target.value.trim())}),_.addEventListener("keydown",q=>{if(q.key==="Enter"){q.preventDefault();const H=_.value.trim();if(a.innerHTML="",j)j(H);else{const F=a.querySelector(".search-result");F&&F.click()}}})}var sn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function cn(_){return _&&_.__esModule&&Object.prototype.hasOwnProperty.call(_,"default")?_.default:_}var Jt={exports:{}};/*! algoliasearch.umd.js | 4.24.0 | Â© Algolia, inc. | https://github.com/algolia/algoliasearch-client-javascript */(function(_,oe){(function(ee,j){_.exports=j()})(sn,function(){function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?j(Object(n),!0).forEach(function(r){ee(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function P(e,t){if(e==null)return{};var n,r,o=function(x,d){if(x==null)return{};var w,k,E={},L=Object.keys(x);for(k=0;k<L.length;k++)w=L[k],d.indexOf(w)>=0||(E[w]=x[w]);return E}(e,t);if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(e);for(r=0;r<y.length;r++)n=y[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function q(e,t){return function(n){if(Array.isArray(n))return n}(e)||function(n,r){if(Symbol.iterator in Object(n)||Object.prototype.toString.call(n)==="[object Arguments]"){var o=[],y=!0,x=!1,d=void 0;try{for(var w,k=n[Symbol.iterator]();!(y=(w=k.next()).done)&&(o.push(w.value),!r||o.length!==r);y=!0);}catch(E){x=!0,d=E}finally{try{y||k.return==null||k.return()}finally{if(x)throw d}}return o}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function H(e){return function(t){if(Array.isArray(t)){for(var n=0,r=new Array(t.length);n<t.length;n++)r[n]=t[n];return r}}(e)||function(t){if(Symbol.iterator in Object(t)||Object.prototype.toString.call(t)==="[object Arguments]")return Array.from(t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function F(e){var t,n="algoliasearch-client-js-".concat(e.key),r=function(){return t===void 0&&(t=e.localStorage||window.localStorage),t},o=function(){return JSON.parse(r().getItem(n)||"{}")},y=function(d){r().setItem(n,JSON.stringify(d))},x=function(){var d=e.timeToLive?1e3*e.timeToLive:null,w=o(),k=Object.fromEntries(Object.entries(w).filter(function(L){return q(L,2)[1].timestamp!==void 0}));if(y(k),d){var E=Object.fromEntries(Object.entries(k).filter(function(L){var C=q(L,2)[1],B=new Date().getTime();return!(C.timestamp+d<B)}));y(E)}};return{get:function(d,w){var k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{miss:function(){return Promise.resolve()}};return Promise.resolve().then(function(){x();var E=JSON.stringify(d);return o()[E]}).then(function(E){return Promise.all([E?E.value:w(),E!==void 0])}).then(function(E){var L=q(E,2),C=L[0],B=L[1];return Promise.all([C,B||k.miss(C)])}).then(function(E){return q(E,1)[0]})},set:function(d,w){return Promise.resolve().then(function(){var k=o();return k[JSON.stringify(d)]={timestamp:new Date().getTime(),value:w},r().setItem(n,JSON.stringify(k)),w})},delete:function(d){return Promise.resolve().then(function(){var w=o();delete w[JSON.stringify(d)],r().setItem(n,JSON.stringify(w))})},clear:function(){return Promise.resolve().then(function(){r().removeItem(n)})}}}function U(e){var t=H(e.caches),n=t.shift();return n===void 0?{get:function(r,o){var y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{miss:function(){return Promise.resolve()}},x=o();return x.then(function(d){return Promise.all([d,y.miss(d)])}).then(function(d){return q(d,1)[0]})},set:function(r,o){return Promise.resolve(o)},delete:function(r){return Promise.resolve()},clear:function(){return Promise.resolve()}}:{get:function(r,o){var y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{miss:function(){return Promise.resolve()}};return n.get(r,o,y).catch(function(){return U({caches:t}).get(r,o,y)})},set:function(r,o){return n.set(r,o).catch(function(){return U({caches:t}).set(r,o)})},delete:function(r){return n.delete(r).catch(function(){return U({caches:t}).delete(r)})},clear:function(){return n.clear().catch(function(){return U({caches:t}).clear()})}}}function ue(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{serializable:!0},t={};return{get:function(n,r){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{miss:function(){return Promise.resolve()}},y=JSON.stringify(n);if(y in t)return Promise.resolve(e.serializable?JSON.parse(t[y]):t[y]);var x=r(),d=o&&o.miss||function(){return Promise.resolve()};return x.then(function(w){return d(w)}).then(function(){return x})},set:function(n,r){return t[JSON.stringify(n)]=e.serializable?JSON.stringify(r):r,Promise.resolve(r)},delete:function(n){return delete t[JSON.stringify(n)],Promise.resolve()},clear:function(){return t={},Promise.resolve()}}}function de(e,t,n){var r={"x-algolia-api-key":n,"x-algolia-application-id":t};return{headers:function(){return e===$.WithinHeaders?r:{}},queryParameters:function(){return e===$.WithinQueryParameters?r:{}}}}function te(e){var t=0;return e(function n(){return t++,new Promise(function(r){setTimeout(function(){r(e(n))},Math.min(100*t,1e3))})})}function s(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(n,r){return Promise.resolve()};return Object.assign(e,{wait:function(n){return s(e.then(function(r){return Promise.all([t(r,n),r])}).then(function(r){return r[1]}))}})}function V(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[n],e[n]=r}return e}function z(e,t){return t&&Object.keys(t).forEach(function(n){e[n]=t[n](e)}),e}function b(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=0;return e.replace(/%s/g,function(){return encodeURIComponent(n[o++])})}var $={WithinQueryParameters:0,WithinHeaders:1};function ie(e,t){var n=e||{},r=n.data||{};return Object.keys(n).forEach(function(o){["timeout","headers","queryParameters","data","cacheable"].indexOf(o)===-1&&(r[o]=n[o])}),{data:Object.entries(r).length>0?r:void 0,timeout:n.timeout||t,headers:n.headers||{},queryParameters:n.queryParameters||{},cacheable:n.cacheable}}var A={Read:1,Write:2,Any:3},fe=1,se=2,pe=3;function ne(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:fe;return a(a({},e),{},{status:t,lastUpdate:Date.now()})}function re(e){return typeof e=="string"?{protocol:"https",url:e,accept:A.Any}:{protocol:e.protocol||"https",url:e.url,accept:e.accept||A.Any}}var Ce="DELETE",K="GET",D="POST",rt="PUT";function ct(e,t){return Promise.all(t.map(function(n){return e.get(n,function(){return Promise.resolve(ne(n))})})).then(function(n){var r=n.filter(function(x){return function(d){return d.status===fe||Date.now()-d.lastUpdate>12e4}(x)}),o=n.filter(function(x){return function(d){return d.status===pe&&Date.now()-d.lastUpdate<=12e4}(x)}),y=[].concat(H(r),H(o));return{getTimeout:function(x,d){return(o.length===0&&x===0?1:o.length+3+x)*d},statelessHosts:y.length>0?y.map(function(x){return re(x)}):t}})}function lt(e,t,n,r){var o=[],y=function(C,B){if(!(C.method===K||C.data===void 0&&B.data===void 0)){var N=Array.isArray(C.data)?C.data:a(a({},C.data),B.data);return JSON.stringify(N)}}(n,r),x=function(C,B){var N=a(a({},C.headers),B.headers),J={};return Object.keys(N).forEach(function(Q){var he=N[Q];J[Q.toLowerCase()]=he}),J}(e,r),d=n.method,w=n.method!==K?{}:a(a({},n.data),r.data),k=a(a(a({"x-algolia-agent":e.userAgent.value},e.queryParameters),w),r.queryParameters),E=0,L=function C(B,N){var J=B.pop();if(J===void 0)throw{name:"RetryError",message:"Unreachable hosts - your application id may be incorrect. If the error persists, please reach out to the Algolia Support team: https://alg.li/support .",transporterStackTrace:$e(o)};var Q={data:y,headers:x,method:d,url:jt(J,n.path,k),connectTimeout:N(E,e.timeouts.connect),responseTimeout:N(E,r.timeout)},he=function(ge){var le={request:Q,response:ge,host:J,triesLeft:B.length};return o.push(le),le},vt={onSuccess:function(ge){return function(le){try{return JSON.parse(le.content)}catch(nt){throw function(Xe,st){return{name:"DeserializationError",message:Xe,response:st}}(nt.message,le)}}(ge)},onRetry:function(ge){var le=he(ge);return ge.isTimedOut&&E++,Promise.all([e.logger.info("Retryable failure",X(le)),e.hostsCache.set(J,ne(J,ge.isTimedOut?pe:se))]).then(function(){return C(B,N)})},onFail:function(ge){throw he(ge),function(le,nt){var Xe=le.content,st=le.status,bt=Xe;try{bt=JSON.parse(Xe).message}catch{}return function(Dt,Vt,on){return{name:"ApiError",message:Dt,status:Vt,transporterStackTrace:on}}(bt,st,nt)}(ge,$e(o))}};return e.requester.send(Q).then(function(ge){return function(le,nt){return function(Xe){var st=Xe.status;return Xe.isTimedOut||function(bt){var Dt=bt.isTimedOut,Vt=bt.status;return!Dt&&~~Vt==0}(Xe)||~~(st/100)!=2&&~~(st/100)!=4}(le)?nt.onRetry(le):~~(le.status/100)==2?nt.onSuccess(le):nt.onFail(le)}(ge,vt)})};return ct(e.hostsCache,t).then(function(C){return L(H(C.statelessHosts).reverse(),C.getTimeout)})}function Re(e){var t=e.hostsCache,n=e.logger,r=e.requester,o=e.requestsCache,y=e.responsesCache,x=e.timeouts,d=e.userAgent,w=e.hosts,k=e.queryParameters,E={hostsCache:t,logger:n,requester:r,requestsCache:o,responsesCache:y,timeouts:x,userAgent:d,headers:e.headers,queryParameters:k,hosts:w.map(function(L){return re(L)}),read:function(L,C){var B=ie(C,E.timeouts.read),N=function(){return lt(E,E.hosts.filter(function(Q){return(Q.accept&A.Read)!=0}),L,B)};if((B.cacheable!==void 0?B.cacheable:L.cacheable)!==!0)return N();var J={request:L,mappedRequestOptions:B,transporter:{queryParameters:E.queryParameters,headers:E.headers}};return E.responsesCache.get(J,function(){return E.requestsCache.get(J,function(){return E.requestsCache.set(J,N()).then(function(Q){return Promise.all([E.requestsCache.delete(J),Q])},function(Q){return Promise.all([E.requestsCache.delete(J),Promise.reject(Q)])}).then(function(Q){var he=q(Q,2);return he[0],he[1]})})},{miss:function(Q){return E.responsesCache.set(J,Q)}})},write:function(L,C){return lt(E,E.hosts.filter(function(B){return(B.accept&A.Write)!=0}),L,ie(C,E.timeouts.write))}};return E}function Le(e){var t={value:"Algolia for JavaScript (".concat(e,")"),add:function(n){var r="; ".concat(n.segment).concat(n.version!==void 0?" (".concat(n.version,")"):"");return t.value.indexOf(r)===-1&&(t.value="".concat(t.value).concat(r)),t}};return t}function jt(e,t,n){var r=Ie(n),o="".concat(e.protocol,"://").concat(e.url,"/").concat(t.charAt(0)==="/"?t.substr(1):t);return r.length&&(o+="?".concat(r)),o}function Ie(e){return Object.keys(e).map(function(t){return b("%s=%s",t,(n=e[t],Object.prototype.toString.call(n)==="[object Object]"||Object.prototype.toString.call(n)==="[object Array]"?JSON.stringify(e[t]):e[t]));var n}).join("&")}function $e(e){return e.map(function(t){return X(t)})}function X(e){var t=e.request.headers["x-algolia-api-key"]?{"x-algolia-api-key":"*****"}:{};return a(a({},e),{},{request:a(a({},e.request),{},{headers:a(a({},e.request.headers),t)})})}var wt=function(e){return function(t,n){return e.transporter.write({method:D,path:"2/abtests",data:t},n)}},Me=function(e){return function(t,n){return e.transporter.write({method:Ce,path:b("2/abtests/%s",t)},n)}},Be=function(e){return function(t,n){return e.transporter.read({method:K,path:b("2/abtests/%s",t)},n)}},He=function(e){return function(t){return e.transporter.read({method:K,path:"2/abtests"},t)}},xt=function(e){return function(t,n){return e.transporter.write({method:D,path:b("2/abtests/%s/stop",t)},n)}},St=function(e){return function(t){return e.transporter.read({method:K,path:"1/strategies/personalization"},t)}},xe=function(e){return function(t,n){return e.transporter.write({method:D,path:"1/strategies/personalization",data:t},n)}};function ut(e){return function t(n){return e.request(n).then(function(r){if(e.batch!==void 0&&e.batch(r.hits),!e.shouldStop(r))return r.cursor?t({cursor:r.cursor}):t({page:(n.page||0)+1})})}({})}var Fe=function(e){return function(t,n){var r=n||{},o=r.queryParameters,y=P(r,["queryParameters"]),x=a({acl:t},o!==void 0?{queryParameters:o}:{});return s(e.transporter.write({method:D,path:"1/keys",data:x},y),function(d,w){return te(function(k){return ze(e)(d.key,w).catch(function(E){if(E.status!==404)throw E;return k()})})})}},Nt=function(e){return function(t,n,r){var o=ie(r);return o.queryParameters["X-Algolia-User-ID"]=t,e.transporter.write({method:D,path:"1/clusters/mapping",data:{cluster:n}},o)}},dt=function(e){return function(t,n,r){return e.transporter.write({method:D,path:"1/clusters/mapping/batch",data:{users:t,cluster:n}},r)}},Se=function(e){return function(t,n){return s(e.transporter.write({method:D,path:b("/1/dictionaries/%s/batch",t),data:{clearExistingDictionaryEntries:!0,requests:{action:"addEntry",body:[]}}},n),function(r,o){return c(e)(r.taskID,o)})}},Ve=function(e){return function(t,n,r){return s(e.transporter.write({method:D,path:b("1/indexes/%s/operation",t),data:{operation:"copy",destination:n}},r),function(o,y){return Ue(e)(t,{methods:{waitTask:Z}}).waitTask(o.taskID,y)})}},qt=function(e){return function(t,n,r){return Ve(e)(t,n,a(a({},r),{},{scope:[Qe.Rules]}))}},Et=function(e){return function(t,n,r){return Ve(e)(t,n,a(a({},r),{},{scope:[Qe.Settings]}))}},It=function(e){return function(t,n,r){return Ve(e)(t,n,a(a({},r),{},{scope:[Qe.Synonyms]}))}},ft=function(e){return function(t,n){return t.method===K?e.transporter.read(t,n):e.transporter.write(t,n)}},Ot=function(e){return function(t,n){return s(e.transporter.write({method:Ce,path:b("1/keys/%s",t)},n),function(r,o){return te(function(y){return ze(e)(t,o).then(y).catch(function(x){if(x.status!==404)throw x})})})}},kt=function(e){return function(t,n,r){var o=n.map(function(y){return{action:"deleteEntry",body:{objectID:y}}});return s(e.transporter.write({method:D,path:b("/1/dictionaries/%s/batch",t),data:{clearExistingDictionaryEntries:!1,requests:o}},r),function(y,x){return c(e)(y.taskID,x)})}},ze=function(e){return function(t,n){return e.transporter.read({method:K,path:b("1/keys/%s",t)},n)}},pt=function(e){return function(t,n){return e.transporter.read({method:K,path:b("1/task/%s",t.toString())},n)}},_t=function(e){return function(t){return e.transporter.read({method:K,path:"/1/dictionaries/*/settings"},t)}},Pt=function(e){return function(t){return e.transporter.read({method:K,path:"1/logs"},t)}},mt=function(e){return function(t){return e.transporter.read({method:K,path:"1/clusters/mapping/top"},t)}},ht=function(e){return function(t,n){return e.transporter.read({method:K,path:b("1/clusters/mapping/%s",t)},n)}},Tt=function(e){return function(t){var n=t||{},r=n.retrieveMappings,o=P(n,["retrieveMappings"]);return r===!0&&(o.getClusters=!0),e.transporter.read({method:K,path:"1/clusters/mapping/pending"},o)}},Ue=function(e){return function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r={transporter:e.transporter,appId:e.appId,indexName:t};return z(r,n.methods)}},Ct=function(e){return function(t){return e.transporter.read({method:K,path:"1/keys"},t)}},$t=function(e){return function(t){return e.transporter.read({method:K,path:"1/clusters"},t)}},Mt=function(e){return function(t){return e.transporter.read({method:K,path:"1/indexes"},t)}},Bt=function(e){return function(t){return e.transporter.read({method:K,path:"1/clusters/mapping"},t)}},Ht=function(e){return function(t,n,r){return s(e.transporter.write({method:D,path:b("1/indexes/%s/operation",t),data:{operation:"move",destination:n}},r),function(o,y){return Ue(e)(t,{methods:{waitTask:Z}}).waitTask(o.taskID,y)})}},Ze=function(e){return function(t,n){return s(e.transporter.write({method:D,path:"1/indexes/*/batch",data:{requests:t}},n),function(r,o){return Promise.all(Object.keys(r.taskID).map(function(y){return Ue(e)(y,{methods:{waitTask:Z}}).waitTask(r.taskID[y],o)}))})}},gt=function(e){return function(t,n){return e.transporter.read({method:D,path:"1/indexes/*/objects",data:{requests:t}},n)}},yt=function(e){return function(t,n){var r=t.map(function(o){return a(a({},o),{},{params:Ie(o.params||{})})});return e.transporter.read({method:D,path:"1/indexes/*/queries",data:{requests:r},cacheable:!0},n)}},Rt=function(e){return function(t,n){return Promise.all(t.map(function(r){var o=r.params,y=o.facetName,x=o.facetQuery,d=P(o,["facetName","facetQuery"]);return Ue(e)(r.indexName,{methods:{searchForFacetValues:Te}}).searchForFacetValues(y,x,a(a({},n),d))}))}},i=function(e){return function(t,n){var r=ie(n);return r.queryParameters["X-Algolia-User-ID"]=t,e.transporter.write({method:Ce,path:"1/clusters/mapping"},r)}},h=function(e){return function(t,n,r){var o=n.map(function(y){return{action:"addEntry",body:y}});return s(e.transporter.write({method:D,path:b("/1/dictionaries/%s/batch",t),data:{clearExistingDictionaryEntries:!0,requests:o}},r),function(y,x){return c(e)(y.taskID,x)})}},l=function(e){return function(t,n){return s(e.transporter.write({method:D,path:b("1/keys/%s/restore",t)},n),function(r,o){return te(function(y){return ze(e)(t,o).catch(function(x){if(x.status!==404)throw x;return y()})})})}},g=function(e){return function(t,n,r){var o=n.map(function(y){return{action:"addEntry",body:y}});return s(e.transporter.write({method:D,path:b("/1/dictionaries/%s/batch",t),data:{clearExistingDictionaryEntries:!1,requests:o}},r),function(y,x){return c(e)(y.taskID,x)})}},m=function(e){return function(t,n,r){return e.transporter.read({method:D,path:b("/1/dictionaries/%s/search",t),data:{query:n},cacheable:!0},r)}},O=function(e){return function(t,n){return e.transporter.read({method:D,path:"1/clusters/mapping/search",data:{query:t}},n)}},v=function(e){return function(t,n){return s(e.transporter.write({method:rt,path:"/1/dictionaries/*/settings",data:t},n),function(r,o){return c(e)(r.taskID,o)})}},S=function(e){return function(t,n){var r=Object.assign({},n),o=n||{},y=o.queryParameters,x=P(o,["queryParameters"]),d=y?{queryParameters:y}:{},w=["acl","indexes","referers","restrictSources","queryParameters","description","maxQueriesPerIPPerHour","maxHitsPerQuery"];return s(e.transporter.write({method:rt,path:b("1/keys/%s",t),data:d},x),function(k,E){return te(function(L){return ze(e)(t,E).then(function(C){return function(B){return Object.keys(r).filter(function(N){return w.indexOf(N)!==-1}).every(function(N){if(Array.isArray(B[N])&&Array.isArray(r[N])){var J=B[N];return J.length===r[N].length&&J.every(function(Q,he){return Q===r[N][he]})}return B[N]===r[N]})}(C)?Promise.resolve():L()})})})}},c=function(e){return function(t,n){return te(function(r){return pt(e)(t,n).then(function(o){return o.status!=="published"?r():void 0})})}},f=function(e){return function(t,n){return s(e.transporter.write({method:D,path:b("1/indexes/%s/batch",e.indexName),data:{requests:t}},n),function(r,o){return Z(e)(r.taskID,o)})}},u=function(e){return function(t){return ut(a(a({shouldStop:function(n){return n.cursor===void 0}},t),{},{request:function(n){return e.transporter.read({method:D,path:b("1/indexes/%s/browse",e.indexName),data:n},t)}}))}},p=function(e){return function(t){var n=a({hitsPerPage:1e3},t);return ut(a(a({shouldStop:function(r){return r.hits.length<n.hitsPerPage}},n),{},{request:function(r){return tt(e)("",a(a({},n),r)).then(function(o){return a(a({},o),{},{hits:o.hits.map(function(y){return delete y._highlightResult,y})})})}}))}},I=function(e){return function(t){var n=a({hitsPerPage:1e3},t);return ut(a(a({shouldStop:function(r){return r.hits.length<n.hitsPerPage}},n),{},{request:function(r){return Lt(e)("",a(a({},n),r)).then(function(o){return a(a({},o),{},{hits:o.hits.map(function(y){return delete y._highlightResult,y})})})}}))}},T=function(e){return function(t,n,r){var o=r||{},y=o.batchSize,x=P(o,["batchSize"]),d={taskIDs:[],objectIDs:[]};return s(function w(){var k,E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,L=[];for(k=E;k<t.length&&(L.push(t[k]),L.length!==(y||1e3));k++);return L.length===0?Promise.resolve(d):f(e)(L.map(function(C){return{action:n,body:C}}),x).then(function(C){return d.objectIDs=d.objectIDs.concat(C.objectIDs),d.taskIDs.push(C.taskID),k++,w(k)})}(),function(w,k){return Promise.all(w.taskIDs.map(function(E){return Z(e)(E,k)}))})}},G=function(e){return function(t){return s(e.transporter.write({method:D,path:b("1/indexes/%s/clear",e.indexName)},t),function(n,r){return Z(e)(n.taskID,r)})}},R=function(e){return function(t){var n=t||{},r=n.forwardToReplicas,o=ie(P(n,["forwardToReplicas"]));return r&&(o.queryParameters.forwardToReplicas=1),s(e.transporter.write({method:D,path:b("1/indexes/%s/rules/clear",e.indexName)},o),function(y,x){return Z(e)(y.taskID,x)})}},M=function(e){return function(t){var n=t||{},r=n.forwardToReplicas,o=ie(P(n,["forwardToReplicas"]));return r&&(o.queryParameters.forwardToReplicas=1),s(e.transporter.write({method:D,path:b("1/indexes/%s/synonyms/clear",e.indexName)},o),function(y,x){return Z(e)(y.taskID,x)})}},me=function(e){return function(t,n){return s(e.transporter.write({method:D,path:b("1/indexes/%s/deleteByQuery",e.indexName),data:t},n),function(r,o){return Z(e)(r.taskID,o)})}},ye=function(e){return function(t){return s(e.transporter.write({method:Ce,path:b("1/indexes/%s",e.indexName)},t),function(n,r){return Z(e)(n.taskID,r)})}},ce=function(e){return function(t,n){return s(Y(e)([t],n).then(function(r){return{taskID:r.taskIDs[0]}}),function(r,o){return Z(e)(r.taskID,o)})}},Y=function(e){return function(t,n){var r=t.map(function(o){return{objectID:o}});return T(e)(r,Ye.DeleteObject,n)}},ae=function(e){return function(t,n){var r=n||{},o=r.forwardToReplicas,y=ie(P(r,["forwardToReplicas"]));return o&&(y.queryParameters.forwardToReplicas=1),s(e.transporter.write({method:Ce,path:b("1/indexes/%s/rules/%s",e.indexName,t)},y),function(x,d){return Z(e)(x.taskID,d)})}},ke=function(e){return function(t,n){var r=n||{},o=r.forwardToReplicas,y=ie(P(r,["forwardToReplicas"]));return o&&(y.queryParameters.forwardToReplicas=1),s(e.transporter.write({method:Ce,path:b("1/indexes/%s/synonyms/%s",e.indexName,t)},y),function(x,d){return Z(e)(x.taskID,d)})}},ve=function(e){return function(t){return We(e)(t).then(function(){return!0}).catch(function(n){if(n.status!==404)throw n;return!1})}},Ae=function(e){return function(t,n,r){return e.transporter.read({method:D,path:b("1/answers/%s/prediction",e.indexName),data:{query:t,queryLanguages:n},cacheable:!0},r)}},De=function(e){return function(t,n){var r=n||{},o=r.query,y=r.paginate,x=P(r,["query","paginate"]),d=0;return function w(){return we(e)(o||"",a(a({},x),{},{page:d})).then(function(k){for(var E=0,L=Object.entries(k.hits);E<L.length;E++){var C=q(L[E],2),B=C[0],N=C[1];if(t(N))return{object:N,position:parseInt(B,10),page:d}}if(d++,y===!1||d>=k.nbPages)throw{name:"ObjectNotFoundError",message:"Object not found."};return w()})}()}},je=function(e){return function(t,n){return e.transporter.read({method:K,path:b("1/indexes/%s/%s",e.indexName,t)},n)}},Pe=function(){return function(e,t){for(var n=0,r=Object.entries(e.hits);n<r.length;n++){var o=q(r[n],2),y=o[0];if(o[1].objectID===t)return parseInt(y,10)}return-1}},Ge=function(e){return function(t,n){var r=n||{},o=r.attributesToRetrieve,y=P(r,["attributesToRetrieve"]),x=t.map(function(d){return a({indexName:e.indexName,objectID:d},o?{attributesToRetrieve:o}:{})});return e.transporter.read({method:D,path:"1/indexes/*/objects",data:{requests:x}},y)}},et=function(e){return function(t,n){return e.transporter.read({method:K,path:b("1/indexes/%s/rules/%s",e.indexName,t)},n)}},We=function(e){return function(t){return e.transporter.read({method:K,path:b("1/indexes/%s/settings",e.indexName),data:{getVersion:2}},t)}},Ne=function(e){return function(t,n){return e.transporter.read({method:K,path:b("1/indexes/%s/synonyms/%s",e.indexName,t)},n)}},qe=function(e){return function(t,n){return s(Je(e)([t],n).then(function(r){return{objectID:r.objectIDs[0],taskID:r.taskIDs[0]}}),function(r,o){return Z(e)(r.taskID,o)})}},Je=function(e){return function(t,n){var r=n||{},o=r.createIfNotExists,y=P(r,["createIfNotExists"]),x=o?Ye.PartialUpdateObject:Ye.PartialUpdateObjectNoCreate;return T(e)(t,x,y)}},be=function(e){return function(t,n){var r=n||{},o=r.safe,y=r.autoGenerateObjectIDIfNotExist,x=r.batchSize,d=P(r,["safe","autoGenerateObjectIDIfNotExist","batchSize"]),w=function(N,J,Q,he){return s(e.transporter.write({method:D,path:b("1/indexes/%s/operation",N),data:{operation:Q,destination:J}},he),function(vt,ge){return Z(e)(vt.taskID,ge)})},k=Math.random().toString(36).substring(7),E="".concat(e.indexName,"_tmp_").concat(k),L=Oe({appId:e.appId,transporter:e.transporter,indexName:E}),C=[],B=w(e.indexName,E,"copy",a(a({},d),{},{scope:["settings","synonyms","rules"]}));return C.push(B),s((o?B.wait(d):B).then(function(){var N=L(t,a(a({},d),{},{autoGenerateObjectIDIfNotExist:y,batchSize:x}));return C.push(N),o?N.wait(d):N}).then(function(){var N=w(E,e.indexName,"move",d);return C.push(N),o?N.wait(d):N}).then(function(){return Promise.all(C)}).then(function(N){var J=q(N,3),Q=J[0],he=J[1],vt=J[2];return{objectIDs:he.objectIDs,taskIDs:[Q.taskID].concat(H(he.taskIDs),[vt.taskID])}}),function(N,J){return Promise.all(C.map(function(Q){return Q.wait(J)}))})}},ot=function(e){return function(t,n){return Ke(e)(t,a(a({},n),{},{clearExistingRules:!0}))}},it=function(e){return function(t,n){return _e(e)(t,a(a({},n),{},{clearExistingSynonyms:!0}))}},Ee=function(e){return function(t,n){return s(Oe(e)([t],n).then(function(r){return{objectID:r.objectIDs[0],taskID:r.taskIDs[0]}}),function(r,o){return Z(e)(r.taskID,o)})}},Oe=function(e){return function(t,n){var r=n||{},o=r.autoGenerateObjectIDIfNotExist,y=P(r,["autoGenerateObjectIDIfNotExist"]),x=o?Ye.AddObject:Ye.UpdateObject;if(x===Ye.UpdateObject){var d=!0,w=!1,k=void 0;try{for(var E,L=t[Symbol.iterator]();!(d=(E=L.next()).done);d=!0)if(E.value.objectID===void 0)return s(Promise.reject({name:"MissingObjectIDError",message:"All objects must have an unique objectID (like a primary key) to be valid. Algolia is also able to generate objectIDs automatically but *it's not recommended*. To do it, use the `{'autoGenerateObjectIDIfNotExist': true}` option."}))}catch(C){w=!0,k=C}finally{try{d||L.return==null||L.return()}finally{if(w)throw k}}}return T(e)(t,x,y)}},at=function(e){return function(t,n){return Ke(e)([t],n)}},Ke=function(e){return function(t,n){var r=n||{},o=r.forwardToReplicas,y=r.clearExistingRules,x=ie(P(r,["forwardToReplicas","clearExistingRules"]));return o&&(x.queryParameters.forwardToReplicas=1),y&&(x.queryParameters.clearExistingRules=1),s(e.transporter.write({method:D,path:b("1/indexes/%s/rules/batch",e.indexName),data:t},x),function(d,w){return Z(e)(d.taskID,w)})}},W=function(e){return function(t,n){return _e(e)([t],n)}},_e=function(e){return function(t,n){var r=n||{},o=r.forwardToReplicas,y=r.clearExistingSynonyms,x=r.replaceExistingSynonyms,d=ie(P(r,["forwardToReplicas","clearExistingSynonyms","replaceExistingSynonyms"]));return o&&(d.queryParameters.forwardToReplicas=1),(x||y)&&(d.queryParameters.replaceExistingSynonyms=1),s(e.transporter.write({method:D,path:b("1/indexes/%s/synonyms/batch",e.indexName),data:t},d),function(w,k){return Z(e)(w.taskID,k)})}},we=function(e){return function(t,n){return e.transporter.read({method:D,path:b("1/indexes/%s/query",e.indexName),data:{query:t},cacheable:!0},n)}},Te=function(e){return function(t,n,r){return e.transporter.read({method:D,path:b("1/indexes/%s/facets/%s/query",e.indexName,t),data:{facetQuery:n},cacheable:!0},r)}},tt=function(e){return function(t,n){return e.transporter.read({method:D,path:b("1/indexes/%s/rules/search",e.indexName),data:{query:t}},n)}},Lt=function(e){return function(t,n){return e.transporter.read({method:D,path:b("1/indexes/%s/synonyms/search",e.indexName),data:{query:t}},n)}},Ft=function(e){return function(t,n){var r=n||{},o=r.forwardToReplicas,y=ie(P(r,["forwardToReplicas"]));return o&&(y.queryParameters.forwardToReplicas=1),s(e.transporter.write({method:rt,path:b("1/indexes/%s/settings",e.indexName),data:t},y),function(x,d){return Z(e)(x.taskID,d)})}},Z=function(e){return function(t,n){return te(function(r){return function(o){return function(y,x){return o.transporter.read({method:K,path:b("1/indexes/%s/task/%s",o.indexName,y.toString())},x)}}(e)(t,n).then(function(o){return o.status!=="published"?r():void 0})})}},Ye={AddObject:"addObject",UpdateObject:"updateObject",PartialUpdateObject:"partialUpdateObject",PartialUpdateObjectNoCreate:"partialUpdateObjectNoCreate",DeleteObject:"deleteObject"},Qe={Settings:"settings",Synonyms:"synonyms",Rules:"rules"},Kt=1,Yt=2,Qt=3,At=function(e){return function(t,n){var r=t.map(function(o){return a(a({},o),{},{threshold:o.threshold||0})});return e.transporter.read({method:D,path:"1/indexes/*/recommendations",data:{requests:r},cacheable:!0},n)}},Xt=function(e){return function(t,n){return At(e)(t.map(function(r){return a(a({},r),{},{fallbackParameters:{},model:"bought-together"})}),n)}},Zt=function(e){return function(t,n){return At(e)(t.map(function(r){return a(a({},r),{},{model:"related-products"})}),n)}},en=function(e){return function(t,n){var r=t.map(function(o){return a(a({},o),{},{model:"trending-facets",threshold:o.threshold||0})});return e.transporter.read({method:D,path:"1/indexes/*/recommendations",data:{requests:r},cacheable:!0},n)}},tn=function(e){return function(t,n){var r=t.map(function(o){return a(a({},o),{},{model:"trending-items",threshold:o.threshold||0})});return e.transporter.read({method:D,path:"1/indexes/*/recommendations",data:{requests:r},cacheable:!0},n)}},nn=function(e){return function(t,n){return At(e)(t.map(function(r){return a(a({},r),{},{model:"looking-similar"})}),n)}},rn=function(e){return function(t,n){var r=t.map(function(o){return a(a({},o),{},{model:"recommended-for-you",threshold:o.threshold||0})});return e.transporter.read({method:D,path:"1/indexes/*/recommendations",data:{requests:r},cacheable:!0},n)}};function Ut(e,t,n){var r,o={appId:e,apiKey:t,timeouts:{connect:1,read:2,write:30},requester:{send:function(d){return new Promise(function(w){var k=new XMLHttpRequest;k.open(d.method,d.url,!0),Object.keys(d.headers).forEach(function(B){return k.setRequestHeader(B,d.headers[B])});var E,L=function(B,N){return setTimeout(function(){k.abort(),w({status:0,content:N,isTimedOut:!0})},1e3*B)},C=L(d.connectTimeout,"Connection timeout");k.onreadystatechange=function(){k.readyState>k.OPENED&&E===void 0&&(clearTimeout(C),E=L(d.responseTimeout,"Socket timeout"))},k.onerror=function(){k.status===0&&(clearTimeout(C),clearTimeout(E),w({content:k.responseText||"Network request failed",status:k.status,isTimedOut:!1}))},k.onload=function(){clearTimeout(C),clearTimeout(E),w({content:k.responseText,status:k.status,isTimedOut:!1})},k.send(d.data)})}},logger:(r=Qt,{debug:function(d,w){return Kt>=r&&console.debug(d,w),Promise.resolve()},info:function(d,w){return Yt>=r&&console.info(d,w),Promise.resolve()},error:function(d,w){return console.error(d,w),Promise.resolve()}}),responsesCache:ue(),requestsCache:ue({serializable:!1}),hostsCache:U({caches:[F({key:"".concat("4.24.0","-").concat(e)}),ue()]}),userAgent:Le("4.24.0").add({segment:"Browser"})},y=a(a({},o),n),x=function(){return function(d){return function(w){var k=w.region||"us",E=de($.WithinHeaders,w.appId,w.apiKey),L=Re(a(a({hosts:[{url:"personalization.".concat(k,".algolia.com")}]},w),{},{headers:a(a(a({},E.headers()),{"content-type":"application/json"}),w.headers),queryParameters:a(a({},E.queryParameters()),w.queryParameters)}));return z({appId:w.appId,transporter:L},w.methods)}(a(a(a({},o),d),{},{methods:{getPersonalizationStrategy:St,setPersonalizationStrategy:xe}}))}};return function(d){var w=d.appId,k=de(d.authMode!==void 0?d.authMode:$.WithinHeaders,w,d.apiKey),E=Re(a(a({hosts:[{url:"".concat(w,"-dsn.algolia.net"),accept:A.Read},{url:"".concat(w,".algolia.net"),accept:A.Write}].concat(V([{url:"".concat(w,"-1.algolianet.com")},{url:"".concat(w,"-2.algolianet.com")},{url:"".concat(w,"-3.algolianet.com")}]))},d),{},{headers:a(a(a({},k.headers()),{"content-type":"application/x-www-form-urlencoded"}),d.headers),queryParameters:a(a({},k.queryParameters()),d.queryParameters)}));return z({transporter:E,appId:w,addAlgoliaAgent:function(L,C){E.userAgent.add({segment:L,version:C})},clearCache:function(){return Promise.all([E.requestsCache.clear(),E.responsesCache.clear()]).then(function(){})}},d.methods)}(a(a({},y),{},{methods:{search:yt,searchForFacetValues:Rt,multipleBatch:Ze,multipleGetObjects:gt,multipleQueries:yt,copyIndex:Ve,copySettings:Et,copySynonyms:It,copyRules:qt,moveIndex:Ht,listIndices:Mt,getLogs:Pt,listClusters:$t,multipleSearchForFacetValues:Rt,getApiKey:ze,addApiKey:Fe,listApiKeys:Ct,updateApiKey:S,deleteApiKey:Ot,restoreApiKey:l,assignUserID:Nt,assignUserIDs:dt,getUserID:ht,searchUserIDs:O,listUserIDs:Bt,getTopUserIDs:mt,removeUserID:i,hasPendingMappings:Tt,clearDictionaryEntries:Se,deleteDictionaryEntries:kt,getDictionarySettings:_t,getAppTask:pt,replaceDictionaryEntries:h,saveDictionaryEntries:g,searchDictionaryEntries:m,setDictionarySettings:v,waitAppTask:c,customRequest:ft,initIndex:function(d){return function(w){return Ue(d)(w,{methods:{batch:f,delete:ye,findAnswers:Ae,getObject:je,getObjects:Ge,saveObject:Ee,saveObjects:Oe,search:we,searchForFacetValues:Te,waitTask:Z,setSettings:Ft,getSettings:We,partialUpdateObject:qe,partialUpdateObjects:Je,deleteObject:ce,deleteObjects:Y,deleteBy:me,clearObjects:G,browseObjects:u,getObjectPosition:Pe,findObject:De,exists:ve,saveSynonym:W,saveSynonyms:_e,getSynonym:Ne,searchSynonyms:Lt,browseSynonyms:I,deleteSynonym:ke,clearSynonyms:M,replaceAllObjects:be,replaceAllSynonyms:it,searchRules:tt,getRule:et,deleteRule:ae,saveRule:at,saveRules:Ke,replaceAllRules:ot,browseRules:p,clearRules:R}})}},initAnalytics:function(){return function(d){return function(w){var k=w.region||"us",E=de($.WithinHeaders,w.appId,w.apiKey),L=Re(a(a({hosts:[{url:"analytics.".concat(k,".algolia.com")}]},w),{},{headers:a(a(a({},E.headers()),{"content-type":"application/json"}),w.headers),queryParameters:a(a({},E.queryParameters()),w.queryParameters)}));return z({appId:w.appId,transporter:L},w.methods)}(a(a(a({},o),d),{},{methods:{addABTest:wt,getABTest:Be,getABTests:He,stopABTest:xt,deleteABTest:Me}}))}},initPersonalization:x,initRecommendation:function(){return function(d){return y.logger.info("The `initRecommendation` method is deprecated. Use `initPersonalization` instead."),x()(d)}},getRecommendations:At,getFrequentlyBoughtTogether:Xt,getLookingSimilar:nn,getRecommendedForYou:rn,getRelatedProducts:Zt,getTrendingFacets:en,getTrendingItems:tn}}))}return Ut.version="4.24.0",Ut})})(Jt);var ln=Jt.exports;const un=cn(ln);function dn(_,oe,ee){return un(_,oe).initIndex(ee)}const fn="https://api.opensea.io/api/v2";async function zt(_,oe,ee="ethereum",j={}){const a={"X-API-KEY":oe,accept:"application/json"};j.method==="POST"&&j.body&&(a["content-type"]="application/json");try{const P=await fetch(`${fn}${_}`,{headers:a,...j});if(!P.ok){let q=P.statusText;try{const H=await P.json();q=H.message||(typeof H=="string"?H:JSON.stringify(H)),H.errors&&(q=H.errors.join(", "))}catch{}throw console.error(`OpenSea API Error (${P.status}): ${q} for endpoint ${_}`),new Error(`OpenSea API request failed: ${P.status} - ${q}`)}return P.status===204?null:await P.json()}catch(P){throw console.error(`Error fetching from OpenSea endpoint ${_}:`,P),P}}async function Gt(_,oe,ee="ethereum"){try{const j=await zt(`/chain/${ee}/contract/${_}`,oe,ee);if(j&&j.collection)return j.collection;throw new Error("Could not retrieve collection slug from contract data.")}catch(j){throw console.error(`Error fetching collection slug for ${_}:`,j),j}}async function Wt(_,oe,ee="ethereum",j=null,a=50){if(!_)throw console.error("Collection slug and API key are required to fetch activity."),new Error("Collection slug and API key are required.");try{const P=Math.min(a,50);let q=`/events/collection/${_}?limit=${P}`;return j&&(q+=`&event_type=${j}`),(await zt(q,oe,ee)).asset_events||[]}catch(P){throw console.error(`Error fetching activity for slug ${_}:`,P),P}}async function pn(_,oe,ee="ethereum",j=100,a=20,P=null,q=10,H=0){var de;const F=[];let U=null,ue=0;do{const te=U?`/listings/collection/${_}/all?limit=${Math.min(j,100)}&cursor=${encodeURIComponent(U)}`:`/listings/collection/${_}/all?limit=${Math.min(j,100)}`,s=await zt(te,oe,ee);if((de=s==null?void 0:s.listings)!=null&&de.length){let V=s.listings;Array.isArray(P)&&P.length&&(V=V.filter(z=>{const b=z.order_source||z.order_source_name||z.order_provider||"";return b?P.some($=>b.toLowerCase().includes($)):!0})),F.push(...V)}U=(s==null?void 0:s.next)||null,ue+=1,H&&H>0&&await new Promise(V=>setTimeout(V,H))}while(U&&ue<a);if(q&&q>0){const te=new Map,s=z=>{var $;const b=($=z.price)==null?void 0:$.current;return b?`${b.value}-${b.currency??""}-${b.decimals??""}`:null};for(const z of F){const b=s(z);b&&te.set(b,(te.get(b)||0)+1)}const V=new Set([...te.entries()].filter(([,z])=>z>=q).map(([z])=>z));if(V.size)return F.filter(z=>!V.has(s(z)))}return F}async function mn(_,oe,{pageSize:ee=1e3,maxPages:j=1/0,chain:a="ethereum",sort:P="desc"}={}){const q="https://api.etherscan.io/api";let H=1;const F="0x0000000000000000000000000000000000000000",U=new Map,ue=new Set;let de=0,te=0;const s=3;for(;H<=j;){const z=`${q}?module=account&action=tokennfttx&contractaddress=${_}&page=${H}&offset=${ee}&sort=${P}&apikey=${oe}`,b=await fetch(z);if(!b.ok)throw new Error(`Etherscan error ${b.status}`);const $=await b.json();if($.status!=="1"||!Array.isArray($.result))break;const ie=$.result;if(ie.length===0)break;let A=0;for(const fe of ie){const se=parseInt(fe.tokenID,10);if(Number.isFinite(se)){if(P==="desc"){if(ue.has(se))continue;ue.add(se);const pe=fe.to.toLowerCase();if(pe!==F){let ne=U.get(pe);ne||(ne=new Set,U.set(pe,ne)),ne.add(se)}A++}else{const pe=fe.from.toLowerCase(),ne=fe.to.toLowerCase();if(pe!==F){const re=U.get(pe);re&&(re.delete(se),re.size===0&&U.delete(pe))}if(ne!==F){let re=U.get(ne);re||(re=new Set,U.set(ne,re)),re.add(se)}}de+=1}}if(P==="desc"&&(A===0?te+=1:te=0,te>=s)||ie.length<ee)break;H+=1}return{collectors:[...U.entries()].map(([z,b])=>({address:z,tokens:[...b],count:b.size})).sort((z,b)=>b.count-z.count),totalScanned:de}}(function(){const j=dn("8I4QUDIYPJ","0b78c3d3ea56c86c7d766052bad49abe","songs"),a="533037544c3044d9be47567bbb711433",P="0x19b703f65aa7e1e775bd06c2aa0d0d08c80f1c45",q="EM1PCRCG3FZA7GN4Y4JT8VSR3MTP7X1WNB",H=["opensea","blur"];let F=null,U=null;console.log("OpenSea ENV Vars:",{key:"Loaded",contract:"Loaded"});let ue=null,de=null;async function te(){return ue||de||(de=(async()=>{var g,m,O,v,S,c,f,u;F||(F=await Gt(P,a));const i=await pn(F,a,"ethereum",100,65,H,0,800),h=new Map;for(const p of i){const I=(v=(O=(m=(g=p==null?void 0:p.protocol_data)==null?void 0:g.parameters)==null?void 0:m.offer)==null?void 0:O[0])==null?void 0:v.identifierOrCriteria;if(I==null)continue;const T=I.toString(),G=(c=(S=p==null?void 0:p.price)==null?void 0:S.current)!=null&&c.value?BigInt(p.price.current.value):BigInt(0),R=h.get(T);if(!R)h.set(T,p);else{const M=(u=(f=R.price)==null?void 0:f.current)!=null&&u.value?BigInt(R.price.current.value):BigInt(0);G<M&&h.set(T,p)}}const l=[...h.values()];return ue=l,l})().catch(i=>{throw de=null,i}),de)}const s=OpenSeadragon({id:"viewer",prefixUrl:"https://cdnjs.cloudflare.com/ajax/libs/openseadragon/4.1.0/images/",showNavigator:!1,showNavigationControl:!1,showHomeControl:!1,showZoomControl:!1,showFullPageControl:!1,constrainDuringPan:!0,visibilityRatio:1,minZoomImageRatio:.8,defaultZoomLevel:.8,springStiffness:5,animationTime:.7,homeFitBounds:!0,tileSources:{height:20520,width:36960,tileSize:256,minLevel:0,maxLevel:7,getTileUrl:function(i,h,l){return`https://songadaygallery.blob.core.windows.net/dzi/level_${i}/tiles/${h}_${l}.jpg`}}}),V=77,z=76,b=36960/V,$=20520/z,ie=document.createElement("div");ie.id="gif-container",s.canvas.appendChild(ie);const A=document.createElement("div");A.className="highlight-box",s.element.appendChild(A);let fe=null,se=new Map;const pe=new Map,ne=new Map;let re=null;function Ce(){pe.forEach(i=>i.remove()),pe.clear()}function K(i){const h=(i-1)%V,l=Math.floor((i-1)/V),g=new OpenSeadragon.Rect(h*b,l*$,b,$),m=document.createElement("div");m.style.position="absolute",m.style.pointerEvents="none",m.style.zIndex="1001",m.style.border="2px solid #1f7a3d";const O=s.viewport.imageToViewportRectangle(g),v=s.viewport.viewportToViewerElementRectangle(O);return m.style.left=v.x+"px",m.style.top=v.y+"px",m.style.width=v.width+"px",m.style.height=v.height+"px",s.element.appendChild(m),s.addHandler("animation",()=>{if(!m.parentNode)return;const S=s.viewport.imageToViewportRectangle(g),c=s.viewport.viewportToViewerElementRectangle(S);m.style.left=c.x+"px",m.style.top=c.y+"px",m.style.width=c.width+"px",m.style.height=c.height+"px"}),m}function D(i){Ce(),Array.from(new Set(i.map(l=>parseInt(l,10)).filter(l=>Number.isFinite(l)&&l>=1&&l<=5852))).forEach(l=>{const g=K(l);pe.set(l,g)})}function rt(i){if(!i)return null;const h=s.viewport.pointFromPixel(i),l=s.viewport.viewportToImageCoordinates(h),g=Math.floor(l.x/b),m=Math.floor(l.y/$);if(g>=0&&g<V&&m>=0&&m<z){const O=m*V+g+1;if(O<=5852)return{id:O,rect:new OpenSeadragon.Rect(g*b,m*$,b,$)}}return null}function ct(){const i=s.viewport.getBounds(),h=s.viewport.viewportToImageRectangle(i),l=Math.max(0,Math.floor(h.x/b)),g=Math.max(0,Math.floor(h.y/$)),m=Math.min(V-1,Math.ceil((h.x+h.width)/b)),O=Math.min(z-1,Math.ceil((h.y+h.height)/$)),v=[];for(let S=g;S<=O;S++)for(let c=l;c<=m;c++){const f=S*V+c+1;f<=5852&&v.push({id:f,rect:new OpenSeadragon.Rect(c*b,S*$,b,$)})}return v}function lt(){const i=s.viewport.getZoom(),h=s.viewport.getMaxZoom();if(i>h*.2){const m=ct(),O=new Set;m.forEach(v=>{if(O.add(v.id),!se.has(v.id)){const u=document.createElement("div");u.className="gif-overlay";const p=document.createElement("img");p.src=`https://songadaygallery.blob.core.windows.net/dzi/${v.id}.gif`,u.appendChild(p),ie.appendChild(u),se.set(v.id,u)}const S=se.get(v.id),c=s.viewport.imageToViewportRectangle(v.rect),f=s.viewport.viewportToViewerElementRectangle(c);S.style.left=f.x+"px",S.style.top=f.y+"px",S.style.width=f.width+"px",S.style.height=f.height+"px",S.style.display="block"});for(const[v,S]of se)O.has(v)||(S.remove(),se.delete(v))}else se.forEach(m=>m.remove()),se.clear()}function Re(i){const h=rt(i);if(h){fe=h.id;const l=s.viewport.imageToViewportRectangle(h.rect),g=s.viewport.viewportToViewerElementRectangle(l);A.style.left=g.x+"px",A.style.top=g.y+"px",A.style.width=g.width+"px",A.style.height=g.height+"px",A.style.display="block"}else fe=null,A.style.display="none"}s.addHandler("animation",function(){lt(),fe&&s.lastMousePosition&&Re(s.lastMousePosition),Ze()}),s.addHandler("update-viewport",()=>{lt(),fe&&s.lastMousePosition&&Re(s.lastMousePosition),Ze()}),new OpenSeadragon.MouseTracker({element:s.canvas,moveHandler:i=>{i.buttons||Re(i.position)},overHandler:i=>{i.buttons||Re(i.position)},outHandler:()=>{fe=null,A.style.display="none"},stopHandler:()=>{fe&&s.lastMousePosition&&Re(s.lastMousePosition)}}),fetch("data/coordinate_maps.json").then(i=>i.json()).then(i=>{window.songCoordinates=i}).catch(i=>console.error("Error loading coordinates:",i));const Le=document.getElementById("songModal"),jt=Le.querySelector(".close-button"),Ie=document.getElementById("left-sidebar"),$e=Ie.querySelector(".left-sidebar-title"),X=Ie.querySelector(".left-sidebar-content"),wt=document.getElementById("close-left-sidebar-btn"),Me=document.getElementById("activity-btn"),Be=document.getElementById("collectors-btn"),He=document.getElementById("for-sale-btn"),xt=document.getElementById("home-view-btn"),St=document.getElementById("search-input"),xe=document.getElementById("for-sale-count");jt.addEventListener("click",()=>Le.style.display="none"),Le.addEventListener("click",i=>{i.target===Le&&(Le.style.display="none")}),xt&&xt.addEventListener("click",()=>s.viewport.goHome()),St&&an(St,j,i=>Fe(i),i=>Nt(i));function ut(i){return i?i.includes("youtu.be")?i.split("youtu.be/")[1]:new URL(i).searchParams.get("v"):null}async function Fe(i){try{const h=await j.getObject(i.toString());if(!h){console.error("Song not found in Algolia:",i);return}const l=Le.querySelector(".modal-content");l.querySelector(".song-title").textContent=h.name,l.querySelector(".song-number").textContent=`Song #${h.token_id}`,l.querySelectorAll(".os-link").forEach(c=>c.remove());const g=document.createElement("a");g.href=`https://opensea.io/assets/ethereum/${P}/${h.token_id}`,g.textContent="View on OpenSea",g.target="_blank",g.style.display="inline-block",g.style.margin="8px 0",g.style.fontWeight="600",g.className="external-link os-link";const m=l.querySelector(".song-number");m==null||m.after(g);const O=l.querySelector(".video-container");if(O.innerHTML="",h.youtube_url){const c=ut(h.youtube_url);if(c){const f=document.createElement("iframe");f.src=`https://www.youtube.com/embed/${c}`,f.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",f.allowFullscreen=!0,O.appendChild(f)}}const v=l.querySelector(".attributes-grid");v.innerHTML="",h.attributes&&Array.isArray(h.attributes)&&h.attributes.forEach(c=>{if(c.trait_type!=="Song A Day"){const f=document.createElement("div");f.className="attribute-item",f.innerHTML=`<div class="attribute-label">${c.trait_type}</div><div class="attribute-value">${c.value}</div>`,v.appendChild(f)}});const S=l.querySelector(".external-links");if(S.innerHTML="",h.external_url){const c=document.createElement("a");c.href=h.external_url,c.className="external-link",c.textContent="View on Song A Day",c.target="_blank",S.appendChild(c)}Le.style.display="block"}catch(h){console.error("Error fetching song details from Algolia:",h)}}async function Nt(i){var h,l;if(i)try{const{hits:g}=await j.search(i,{hitsPerPage:50}),m=document.getElementById("left-sidebar"),O=m.querySelector(".left-sidebar-title"),v=m.querySelector(".left-sidebar-content");if(!m||!O||!v){console.error("Left sidebar elements not found for search results!");return}if(v.innerHTML="",O.textContent=`Results for "${i}"`,g.length===0){const S=document.createElement("p");S.textContent="No results found.",v.appendChild(S)}else{const S=document.createElement("ul");S.className="search-results-list",S.style.listStyleType="none",S.style.paddingLeft="0",g.forEach(c=>{const f=document.createElement("li");f.style.padding="8px 0",f.style.borderBottom="1px solid rgba(255,255,255,0.1)",f.style.cursor="pointer";const u=c.name||`Song #${c.token_id}`,p=c.objectID;f.textContent=u,f.addEventListener("click",()=>{m.classList.remove("visible"),Fe(parseInt(p,10))}),p&&(f.addEventListener("mouseenter",()=>{const I=parseInt(p,10);if(!Number.isFinite(I)||I<1||I>5852)return;const T=(I-1)%V,G=Math.floor((I-1)/V),R=new OpenSeadragon.Rect(T*b,G*$,b,$),M=1.5,me=R.width*(M-1)/2,ye=R.height*(M-1)/2,ce=new OpenSeadragon.Rect(R.x-me,R.y-ye,R.width*M,R.height*M),Y=s.viewport.imageToViewportRectangle(ce);s.viewport.fitBounds(Y,!1);const ae=s.viewport.viewportToViewerElementRectangle(s.viewport.imageToViewportRectangle(R));A.style.left=ae.x+"px",A.style.top=ae.y+"px",A.style.width=ae.width+"px",A.style.height=ae.height+"px",A.style.display="block"}),f.addEventListener("mouseleave",()=>{A.style.display="none"})),f.addEventListener("mouseenter",()=>{f.style.background="rgba(255,255,255,0.1)"}),f.addEventListener("mouseleave",()=>{f.style.background=""}),S.appendChild(f)}),v.appendChild(S)}m.classList.add("visible")}catch(g){console.error("Error performing search and displaying in sidebar",g);const m=(h=document.getElementById("left-sidebar"))==null?void 0:h.querySelector(".left-sidebar-content");m&&(m.innerHTML="<p>Error loading search results.</p>",(l=document.getElementById("left-sidebar"))==null||l.classList.add("visible"))}}s.addHandler("canvas-click",function(i){if(!i.quick)return;const h=rt(i.position);h&&Fe(h.id)});let dt=new Map,Se=new Map,Ve=new Map;function qt(i){const h=(i-1)%V,l=Math.floor((i-1)/V),g=new OpenSeadragon.Rect(h*b,l*$,b,$),m=document.createElement("div");m.style.position="absolute",m.style.background="rgba(0,0,0,0.5)",m.style.pointerEvents="none",m.style.zIndex="1001";const O=s.viewport.imageToViewportRectangle(g),v=s.viewport.viewportToViewerElementRectangle(O);return m.style.left=v.x+"px",m.style.top=v.y+"px",m.style.width=v.width+"px",m.style.height=v.height+"px",s.canvas.appendChild(m),s.addHandler("animation",()=>{if(!m.parentNode)return;const S=s.viewport.imageToViewportRectangle(g),c=s.viewport.viewportToViewerElementRectangle(S);m.style.left=c.x+"px",m.style.top=c.y+"px",m.style.width=c.width+"px",m.style.height=c.height+"px"}),m}function Et(){const i=[];return Se.forEach((h,l)=>{const g=[];h.forEach(m=>{g.push(`${l}:${m}`)}),g.length>0&&i.push(g)}),i}async function It(){dt.forEach(h=>h.remove()),dt.clear();const i=Et();if(i.length===0){yt();return}try{const{hits:h}=await j.search("",{facetFilters:i,attributesToRetrieve:["objectID"],hitsPerPage:5852}),l=h.map(O=>parseInt(O.objectID,10)).filter(O=>Number.isFinite(O)),g=new Set(l);ct().forEach(O=>{if(!g.has(O.id)){const v=qt(O.id);dt.set(O.id,v)}}),Rt(l)}catch(h){console.error("Error applying filters with Algolia:",h)}}async function ft(){const i=document.querySelector("#right-sidebar .filter-content");i.innerHTML="";const h=["Topic","Genre","Mood","Location","Instrument","Style","Noun","Proper Noun"],l=document.createElement("button");l.textContent="Clear Filters",l.style.margin="0 0 12px 16px",l.addEventListener("click",()=>{i.querySelectorAll(".filter-checkbox").forEach(g=>g.checked=!1),Se.clear(),s.viewport.goHome(),It(),ft()}),i.appendChild(l);try{const{facets:g}=await j.search("",{facets:h,hitsPerPage:0,maxValuesPerFacet:1e3,facetFilters:Et()});if(!g){console.error("No facets received from Algolia.");return}h.forEach(m=>{const O=g[m];if(!O||Object.keys(O).length===0)return;const v=document.createElement("div");v.className="filter-section";const S=document.createElement("div");S.className="filter-section-header",S.innerHTML=`<span class="filter-section-title">${m}</span><span class="filter-count">${Object.keys(O).length}</span>`;const c=document.createElement("div");c.className="filter-options",c.style.display="none",Object.entries(O).sort(([u,p],[I,T])=>T===p?u.localeCompare(I):T-p).forEach(([u,p])=>{const I=document.createElement("div");I.className="filter-option";const T=`filter-${m}-${u}`.replace(/\s+/g,"-").toLowerCase(),G=Se.has(m)&&Se.get(m).has(u);I.innerHTML=`
                        <input type="checkbox" id="${T}" class="filter-checkbox" data-trait="${m}" data-value="${u}" ${G?"checked":""}>
                        <label for="${T}" class="filter-label"><span class="filter-value">${u}</span><span class="filter-value-count">${p}</span></label>`,I.querySelector("input").addEventListener("change",R=>{const M=R.target.dataset.trait,me=R.target.dataset.value;Se.has(M)||Se.set(M,new Set),R.target.checked?Se.get(M).add(me):(Se.get(M).delete(me),Se.get(M).size===0&&Se.delete(M)),s.viewport.goHome(),It(),ft(),R.stopPropagation()}),c.appendChild(I)}),v.appendChild(S),v.appendChild(c),i.appendChild(v),S.addEventListener("click",()=>{const u=c.style.display==="none";document.querySelectorAll(".filter-options").forEach(p=>p.style.display="none"),u&&(c.style.display="block")})})}catch(g){console.error("Error initializing filter sections from Algolia:",g)}}function Ot(){const i=document.getElementById("right-sidebar");i.classList.contains("visible")?i.classList.remove("visible"):(i.classList.add("visible"),i.hasAttribute("data-initialized")||(ft(),i.setAttribute("data-initialized","true")))}const kt=document.getElementById("explore-btn");kt&&kt.addEventListener("click",Ot);const ze=document.getElementById("close-filter-btn");ze&&ze.addEventListener("click",Ot);const pt=document.createElement("style");pt.textContent=`
        .filter-option{display:flex;align-items:center;justify-content:space-between;padding:8px 16px;}
        .filter-option:hover{background:rgba(0,0,0,0.05);}
        .filter-label{flex:1;display:flex;justify-content:space-between;align-items:center;margin-left:12px;cursor:pointer;}
        .filter-value{color:black;}
        .filter-value-count{color:#666;font-size:14px;}
        .filter-section-header{padding:12px 16px;}
        .filter-options{background:#f5f5f5;margin:0 -20px;}
    `,document.head.appendChild(pt),s.addHandler("open",()=>{s.viewport.goHome(!0);const i=s.viewport.getHomeBounds();typeof s.viewport.fitBounds=="function"&&s.viewport.fitBounds(i,!0)});async function _t(){if(!F||!xe){xe&&(xe.textContent="N/A");return}try{const i=await te();xe.textContent=i.length.toString()}catch(i){console.error("Failed to update for-sale count:",i),xe&&(xe.textContent="N/A")}}async function Pt(){console.log("initOpenSea called. API Key:","Present","Contract:","Present");try{const i=await Gt(P,a);i?(F=i,console.log("Fetched OpenSea collection slug:",F),_t().catch(h=>console.error("updateForSaleCount error",h))):(console.error("Failed to fetch OpenSea collection slug. Slug was null or empty."),xe&&(xe.textContent="N/A"),Me&&(Me.disabled=!0),Be&&(Be.disabled=!0),He&&(He.disabled=!0))}catch(i){console.error("Error initializing OpenSea:",i),xe&&(xe.textContent="N/A"),Me&&(Me.disabled=!0),Be&&(Be.disabled=!0),He&&(He.disabled=!0)}}async function mt(i,h){if(console.log(`openLeftSidebar called with contentType: ${i}, title: ${h}`),!Ie||!$e||!X){console.error("Left sidebar elements not found!");return}if(!F&&(i==="forSale"||i==="activity"||i==="collectors")&&($e.textContent=h,X.innerHTML="<p>Initializing OpenSea data...</p>",console.log("Attempting to show left sidebar for initializing OpenSea"),Ie.classList.add("visible"),await Pt(),!F)){$e.textContent="Error",X.innerHTML="<p>Could not load collection data. Please check console for errors.</p>",console.log("Attempting to show left sidebar for slug fetch error"),Ie.classList.add("visible");return}$e.textContent=h,X.innerHTML="<p>Loading data...</p>",Ie.classList.contains("visible")||(console.log("Attempting to show left sidebar for content loading"),Ie.classList.add("visible"));try{let l;if(!F)throw new Error("Collection slug not available.");switch(i!=="sales"&&gt(),i){case"forSale":l=await te(),await Tt(l,X),s.viewport.goHome();const g=l.map(v=>{var S,c,f,u;return(u=(f=(c=(S=v==null?void 0:v.protocol_data)==null?void 0:S.parameters)==null?void 0:c.offer)==null?void 0:f[0])==null?void 0:u.identifierOrCriteria}).map(v=>parseInt(v,10)).filter(v=>Number.isFinite(v));re=new Set(g),D(g),Ze();break;case"activity":if(!X.querySelector(".activity-tabs")){const v=document.createElement("div");v.className="activity-tabs",v.style.display="flex",v.style.gap="12px",v.style.marginBottom="12px",[{label:"Listings",type:"listing"},{label:"All",type:null},{label:"Sales",type:"sale"},{label:"Offers",type:"offer"}].forEach(c=>{const f=document.createElement("button");f.textContent=c.label,f.className="activity-tab-btn",f.dataset.eventType=c.type??"",f.style.padding="6px 10px",f.style.border="none",f.style.borderRadius="4px",f.style.cursor="pointer",f.style.background="rgba(255,255,255,0.1)",f.style.color="#fff",f.addEventListener("click",async()=>{var u;Array.from(v.children).forEach(p=>p.classList.remove("active")),f.classList.add("active"),(u=X.querySelector(".activity-list"))==null||u.remove(),await m(c.type)}),v.appendChild(f)}),v.firstChild.classList.add("active"),X.innerHTML="",X.appendChild(v)}const m=async v=>{var c,f,u;(c=X.querySelector(".activity-loading"))==null||c.remove();const S=document.createElement("p");S.textContent="Loading activity...",S.className="activity-loading",X.appendChild(S);try{if(v==="listing"){const p=await te();(f=X.querySelector(".activity-list"))==null||f.remove(),(u=X.querySelector(".for-sale-list"))==null||u.remove();const I=document.createElement("div");I.className="for-sale-list",X.appendChild(I),await Tt(p,I)}else{const I=(await Wt(F,a,"ethereum",v,50)).filter(T=>T.order_type!=="collection_offer");Ue(I,X)}}catch(p){console.error("Activity load error",p),S.textContent="Failed to load activity."}finally{S.remove()}};await m("listing");return;case"collectors":l=await mn(P,q,{pageSize:1e3,sort:"desc"}),U=l,Ct(l,X);break;case"sales":l=await Wt(F,a,"ethereum","sale",50),Ue(l,X),s.viewport.goHome();const O=l.map(Mt).map(v=>parseInt(v,10)).filter(v=>Number.isFinite(v));re=new Set(O),D(O),Ze();break;default:X.innerHTML="<p>Selected section not yet implemented.</p>"}}catch(l){console.error(`Error fetching OpenSea ${i} data:`,l),$e.textContent="Error",X.innerHTML="<p>Failed to load data from OpenSea. Please try again later.</p>"}}Me&&Me.addEventListener("click",()=>{console.log("Sales button clicked"),mt("sales","Recent Sales")}),Be&&Be.addEventListener("click",()=>{console.log("Collectors button clicked"),mt("collectors","Top Collectors")}),He&&He.addEventListener("click",()=>{console.log("For Sale button clicked"),mt("forSale","Items For Sale")}),wt&&wt.addEventListener("click",()=>{console.log("Close left sidebar button clicked"),Ie.classList.remove("visible"),gt()});function ht(i,h=18,l=4){try{if(!i)return"0";const g=BigInt(i.toString()),m=BigInt(10)**BigInt(h),O=g/m;let S=(g%m).toString().padStart(h,"0");return S=S.slice(0,l),S=S.replace(/0+$/,""),S.length>0?`${O}.${S}`:O.toString()}catch{return"0"}}async function Tt(i,h){if(h.innerHTML="",!i||i.length===0){h.innerHTML="<p>No items currently for sale.</p>";return}const l=new Map,g=[];i.forEach(c=>{var I,T,G,R,M,me,ye,ce;const f=(R=(G=(T=(I=c==null?void 0:c.protocol_data)==null?void 0:I.parameters)==null?void 0:T.offer)==null?void 0:G[0])==null?void 0:R.identifierOrCriteria;if(f==null){g.push(c);return}const u=f.toString(),p=l.get(u);if(!p)l.set(u,c);else{const Y=(me=(M=c.price)==null?void 0:M.current)!=null&&me.value?BigInt(c.price.current.value):BigInt(0),ae=(ce=(ye=p.price)==null?void 0:ye.current)!=null&&ce.value?BigInt(p.price.current.value):BigInt(0);if(Y<ae)l.set(u,c);else if(Y===ae){const ke=ve=>Date.parse(ve.created_date||ve.order_created_date||ve.listing_date||ve.updated_date||0);ke(c)>ke(p)&&l.set(u,c)}}});let m=[...l.values(),...g];const O=document.createElement("ul");O.style.listStyleType="none",O.style.paddingLeft="0",m.sort((c,f)=>{var I,T,G,R;const u=(T=(I=c.price)==null?void 0:I.current)!=null&&T.value?BigInt(c.price.current.value):BigInt(0),p=(R=(G=f.price)==null?void 0:G.current)!=null&&R.value?BigInt(f.price.current.value):BigInt(0);return u>p?1:u<p?-1:0});const v=m.map(c=>{var u,p,I,T;const f=(T=(I=(p=(u=c.protocol_data)==null?void 0:u.parameters)==null?void 0:p.offer)==null?void 0:I[0])==null?void 0:T.identifierOrCriteria;return f?f.toString():null}).filter(Boolean),S={};if(v.length)try{const{results:c}=await j.getObjects(v);c.forEach(f=>{f&&(S[f.objectID]=f.name)})}catch(c){console.error("Error fetching titles from Algolia:",c)}m.forEach(c=>{var ce,Y,ae,ke,ve,Ae,De,je,Pe,Ge,et,We,Ne,qe,Je;const f=document.createElement("li");f.style.padding="8px 0",f.style.borderBottom="1px solid #444";let u=null;(ae=(Y=(ce=c.protocol_data)==null?void 0:ce.parameters)==null?void 0:Y.offer)!=null&&ae.length&&(u=c.protocol_data.parameters.offer[0].identifierOrCriteria);const p=u!=null?u.toString():null,I=p&&S[p]||((ke=c.nft)==null?void 0:ke.name)||((ve=c.asset)==null?void 0:ve.name)||(u?`Song #${u}`:"Unknown Song"),T=(De=(Ae=c.price)==null?void 0:Ae.current)==null?void 0:De.value,G=((Pe=(je=c.price)==null?void 0:je.current)==null?void 0:Pe.decimals)||18,R=T?ht(T,G):"N/A",M=((et=(Ge=c.price)==null?void 0:Ge.current)==null?void 0:et.currency)||"ETH",ye=((We=c.nft)==null?void 0:We.image_url)||((Ne=c.nft)==null?void 0:Ne.display_image_url)||((qe=c.asset)==null?void 0:qe.image_url)||((Je=c.asset)==null?void 0:Je.display_image_url)||""||(u?`https://songadaygallery.blob.core.windows.net/dzi/${u}.gif`:"");f.innerHTML=`<div style="display:flex;gap:10px;align-items:center;">
                    <img src="${ye}" style="width:48px;height:48px;object-fit:cover;border-radius:4px;background:#222;" />
                    <div style="flex:1;">
                        <div style="font-weight:600;">${I}</div>
                        <div style="font-size:12px;color:#aaa;">Song #${u??"â"}</div>
                    </div>
                    <div style="text-align:right;white-space:nowrap;">${R} ${M}</div>
                 </div>`,O.appendChild(f),u&&(f.addEventListener("mouseenter",()=>{const be=parseInt(p,10);if(!Number.isFinite(be)||be<1||be>5852)return;const ot=(be-1)%V,it=Math.floor((be-1)/V),Ee=new OpenSeadragon.Rect(ot*b,it*$,b,$),Oe=1.5,at=Ee.width*(Oe-1)/2,Ke=Ee.height*(Oe-1)/2,W=new OpenSeadragon.Rect(Ee.x-at,Ee.y-Ke,Ee.width*Oe,Ee.height*Oe),_e=s.viewport.imageToViewportRectangle(W);s.viewport.fitBounds(_e,!1);const we=s.viewport.viewportToViewerElementRectangle(s.viewport.imageToViewportRectangle(Ee));A.style.left=we.x+"px",A.style.top=we.y+"px",A.style.width=we.width+"px",A.style.height=we.height+"px",A.style.display="block"}),f.addEventListener("mouseleave",()=>{A.style.display="none"}),f.addEventListener("click",()=>{const be=parseInt(p,10);Number.isFinite(be)&&Fe(be)})),f.addEventListener("mouseenter",()=>{f.style.background="rgba(255,255,255,0.05)"}),f.addEventListener("mouseleave",()=>{f.style.background=""})}),h.appendChild(O)}function Ue(i,h){var f;const l=u=>{var p,I,T,G,R,M;return((p=u==null?void 0:u.nft)==null?void 0:p.identifier)??((I=u==null?void 0:u.asset)==null?void 0:I.token_id)??((M=(R=(G=(T=u==null?void 0:u.protocol_data)==null?void 0:T.parameters)==null?void 0:G.offer)==null?void 0:R[0])==null?void 0:M.identifierOrCriteria)??null};if((f=h.querySelector(".activity-list"))==null||f.remove(),!i||i.length===0){const u=document.createElement("p");u.textContent="No recent activity.",h.appendChild(u);return}const g=new Set;i.forEach(u=>{const p=l(u);p!=null&&g.add(p.toString())});const m={},O={},v=new Set;i.forEach(u=>{var I,T;const p=l(u);if(p==null){const G=(((I=u==null?void 0:u.nft)==null?void 0:I.name)||((T=u==null?void 0:u.asset)==null?void 0:T.name)||"").trim();G&&v.add(G.toLowerCase())}});const S=[];if(g.size&&S.push(j.getObjects(Array.from(g)).then(({results:u})=>{u.forEach(p=>{p&&(m[p.objectID]=p.name)})}).catch(u=>console.error("Algolia title fetch error",u))),v.size){const u=Array.from(v).map(p=>j.search(p,{hitsPerPage:1,restrictSearchableAttributes:["name"],attributesToRetrieve:["objectID"]}).then(I=>{const T=I.hits&&I.hits[0];T&&(O[p]=T.objectID,m[T.objectID]=T.name||p)}).catch(I=>console.error("Algolia lookup error",I)));S.push(Promise.all(u))}Promise.all(S).then(()=>{if(i.length&&i[0].event_type==="listing"){const u=new Set;i=i.filter(p=>{const I=l(p);return I==null?!0:u.has(I)?!1:(u.add(I),!0)})}c()}).catch(u=>{console.error("Algolia async error",u),c()});function c(){const u=document.createElement("ul");u.className="activity-list",u.style.listStyleType="none",u.style.paddingLeft="0",i.forEach(p=>{var Je,be,ot,it,Ee,Oe,at,Ke;const I=document.createElement("li");I.className="activity-row",I.style.display="flex",I.style.alignItems="center",I.style.gap="12px",I.style.padding="10px 0",I.style.borderBottom="1px solid #444";const T=document.createElement("img");T.className="activity-thumb",T.style.width="48px",T.style.height="48px",T.style.objectFit="cover",T.style.borderRadius="4px";const G=((Je=p.nft)==null?void 0:Je.display_image_url)||((be=p.nft)==null?void 0:be.image_url)||((ot=p.asset)==null?void 0:ot.display_image_url)||((it=p.asset)==null?void 0:it.image_url)||"";G?T.src=G:T.style.background="#222",I.appendChild(T);let R=l(p);if(R==null){const W=(((Ee=p.nft)==null?void 0:Ee.name)||((Oe=p.asset)==null?void 0:Oe.name)||"").trim().toLowerCase();W&&O[W]&&(R=O[W])}const M=R!=null?R.toString():"",me=M&&m[M]||((at=p.nft)==null?void 0:at.name)||((Ke=p.asset)==null?void 0:Ke.name)||`Song #${M}`,ye=p.event_type.replace(/_/g," "),ce=document.createElement("div");ce.style.flex="1";const Y=document.createElement("span");Y.textContent=ye.charAt(0).toUpperCase()+ye.slice(1),Y.className=`activity-badge badge-${p.event_type}`,Y.style.padding="2px 6px",Y.style.borderRadius="4px",Y.style.fontSize="11px",Y.style.fontWeight="700",Y.style.textTransform="capitalize",Y.style.marginRight="6px";const ae={sale:"#1f7a3d",listing:"#7a3d1f",offer:"#3d5d7a"};Y.style.background=ae[p.event_type]||"#555",Y.style.color="#fff";const ke=document.createElement("span");ke.textContent=me;const ve=document.createElement("div");ve.appendChild(Y),ve.appendChild(ke);const Ae=W=>W?`${W.slice(0,4)}â¦${W.slice(-4)}`:"";let De="";p.buyer&&p.seller?De=`${Ae(p.seller)} â ${Ae(p.buyer)}`:p.maker&&p.taker!==void 0&&(De=`${Ae(p.maker)} â ${Ae(p.taker||"")}`);const je=document.createElement("div");je.style.fontSize="11px",je.style.color="#aaa",je.textContent=De,ce.appendChild(ve),De&&ce.appendChild(je),I.appendChild(ce);const Pe=document.createElement("div");Pe.style.textAlign="right",Pe.style.fontSize="12px";let Ge="";p.payment&&p.payment.quantity?Ge=`${ht(p.payment.quantity,p.payment.decimals||18,3)} ${p.payment.symbol||"ETH"}`:p.total_price&&p.payment_token&&(Ge=`${ht(p.total_price,p.payment_token.decimals||18,3)} ${p.payment_token.symbol}`);const et=document.createElement("div");et.textContent=Ge;const We=p.event_timestamp||p.closing_date||null;let Ne="";if(We){const W=Math.floor(Date.now()/1e3)-We,_e=[{l:"y",s:31536e3},{l:"mo",s:2592e3},{l:"d",s:86400},{l:"h",s:3600},{l:"m",s:60}];for(const we of _e)if(W>=we.s){Ne=`${Math.floor(W/we.s)}${we.l}`;break}Ne||(Ne=`${W}s`)}const qe=document.createElement("div");qe.style.color="#aaa",qe.style.fontSize="10px",qe.textContent=Ne,Pe.appendChild(et),Pe.appendChild(qe),I.appendChild(Pe),u.appendChild(I),R&&(I.addEventListener("mouseenter",()=>{const W=parseInt(M,10);if(!Number.isFinite(W)||W<1||W>5852)return;const _e=(W-1)%V,we=Math.floor((W-1)/V),Te=new OpenSeadragon.Rect(_e*b,we*$,b,$),tt=1.5,Lt=Te.width*(tt-1)/2,Ft=Te.height*(tt-1)/2,Z=new OpenSeadragon.Rect(Te.x-Lt,Te.y-Ft,Te.width*tt,Te.height*tt),Ye=s.viewport.imageToViewportRectangle(Z);s.viewport.fitBounds(Ye,!1);const Qe=s.viewport.viewportToViewerElementRectangle(s.viewport.imageToViewportRectangle(Te));A.style.left=Qe.x+"px",A.style.top=Qe.y+"px",A.style.width=Qe.width+"px",A.style.height=Qe.height+"px",A.style.display="block"}),I.addEventListener("mouseleave",()=>{A.style.display="none"}),I.addEventListener("click",()=>{const W=parseInt(M,10);Number.isFinite(W)&&Fe(W)})),I.addEventListener("mouseenter",()=>{I.style.background="rgba(255,255,255,0.05)"}),I.addEventListener("mouseleave",()=>{I.style.background=""})}),h.appendChild(u)}}function Ct(i,h){h.innerHTML="";const{collectors:l,totalScanned:g}=i;if(!l||l.length===0){h.innerHTML="<p>No collector data available.</p>";return}const m=document.createElement("p");m.textContent=`Top collectors (based on ${g.toLocaleString()} transfers analysed):`,m.style.fontSize="12px",m.style.color="#aaa",m.style.marginBottom="8px",h.appendChild(m);const O=document.createElement("ul");O.style.listStyleType="none",O.style.paddingLeft="0";const v=async S=>{try{const f=await(await fetch(`https://api.ensideas.com/ens/resolve/${S}`)).json();if(f!=null&&f.name)return f.name}catch{}return null};l.forEach(S=>{const c=document.createElement("li");c.style.padding="6px 0",c.style.borderBottom="1px solid #444",c.style.cursor="pointer";const f=`${S.address.substring(0,6)}â¦${S.address.substring(S.address.length-4)}`;c.innerHTML=`<span class="collector-name">${f}</span> (<strong>${S.count}</strong>)`,v(S.address).then(u=>{u&&(c.querySelector(".collector-name").textContent=u)}),c.addEventListener("click",()=>{$t(S,h)}),O.appendChild(c)}),h.appendChild(O)}async function $t(i,h){const{address:l,tokens:g}=i;s.viewport.goHome();const m=g.map(f=>parseInt(f,10)).filter(f=>Number.isFinite(f));re=new Set(m),D(m),Ze(),h.innerHTML="";const O=document.createElement("button");O.textContent="â Back to collectors",O.style.marginBottom="8px",O.addEventListener("click",()=>{gt(),Ct({collectors:U.collectors,totalScanned:U.totalScanned},h)}),h.appendChild(O);const v=document.createElement("h3");if(v.textContent=`Tokens owned by ${l.substring(0,6)}â¦${l.slice(-4)}`,v.style.fontSize="14px",v.style.margin="8px 0",h.appendChild(v),m.length===0){h.appendChild(document.createTextNode("No tokens found."));return}let S={};try{const{results:f}=await j.getObjects(m.map(u=>u.toString()));f.forEach(u=>{u&&(S[u.objectID]=u.name)})}catch{}const c=document.createElement("ul");c.style.listStyleType="none",c.style.paddingLeft="0",m.forEach(f=>{const u=document.createElement("li");u.style.padding="6px 0",u.style.borderBottom="1px solid #444";const p=S[f]||`Song #${f}`,I=`https://songadaygallery.blob.core.windows.net/dzi/${f}.gif`;u.innerHTML=`<div style="display:flex;gap:10px;align-items:center;">
                <img src="${I}" style="width:32px;height:32px;object-fit:cover;border-radius:4px;background:#222;" />
                <span>${p}</span>
            </div>`,u.addEventListener("mouseenter",()=>{const T=(f-1)%V,G=Math.floor((f-1)/V),R=new OpenSeadragon.Rect(T*b,G*$,b,$),M=1.5,me=R.width*(M-1)/2,ye=R.height*(M-1)/2,ce=new OpenSeadragon.Rect(R.x-me,R.y-ye,R.width*M,R.height*M),Y=s.viewport.imageToViewportRectangle(ce);s.viewport.fitBounds(Y,!1);const ae=s.viewport.viewportToViewerElementRectangle(s.viewport.imageToViewportRectangle(R));A.style.left=`${ae.x}px`,A.style.top=`${ae.y}px`,A.style.width=`${ae.width}px`,A.style.height=`${ae.height}px`,A.style.display="block"}),u.addEventListener("mouseleave",()=>{A.style.display="none"}),u.addEventListener("click",()=>Fe(f)),c.appendChild(u)}),h.appendChild(c)}Pt().catch(i=>console.error("Early initOpenSea error",i));function Mt(i){var h,l,g,m,O,v;return((h=i==null?void 0:i.nft)==null?void 0:h.identifier)??((l=i==null?void 0:i.asset)==null?void 0:l.token_id)??((v=(O=(m=(g=i==null?void 0:i.protocol_data)==null?void 0:g.parameters)==null?void 0:m.offer)==null?void 0:O[0])==null?void 0:v.identifierOrCriteria)??null}function Bt(){ne.forEach(i=>i.remove()),ne.clear()}function Ht(i){const h=s.viewport.imageToViewportRectangle(i.rect),l=s.viewport.viewportToViewerElementRectangle(h),g=document.createElement("div");return g.style.position="absolute",g.style.background="rgba(0,0,0,0.6)",g.style.pointerEvents="none",g.style.zIndex="1000",g.style.left=l.x+"px",g.style.top=l.y+"px",g.style.width=l.width+"px",g.style.height=l.height+"px",s.element.appendChild(g),g}function Ze(){if(!re)return;ne.forEach((l,g)=>{if(!re.has(g)){l.remove(),ne.delete(g);return}});const i=ct(),h=new Set(i.map(l=>l.id));ne.forEach((l,g)=>{(!h.has(g)||re.has(g))&&(l.remove(),ne.delete(g))}),i.forEach(l=>{if(re.has(l.id))return;const g=ne.get(l.id),m=s.viewport.imageToViewportRectangle(l.rect),O=s.viewport.viewportToViewerElementRectangle(m);if(g)g.style.left=O.x+"px",g.style.top=O.y+"px",g.style.width=O.width+"px",g.style.height=O.height+"px";else{const v=Ht(l);ne.set(l.id,v)}})}function gt(){re=null,Ce(),Bt()}function yt(){Ve.forEach(i=>i.remove()),Ve.clear()}function Rt(i){yt(),Array.from(new Set(i.map(l=>parseInt(l,10)).filter(l=>Number.isFinite(l)&&l>=1&&l<=5852))).forEach(l=>{const g=K(l);Ve.set(l,g)})}})();
