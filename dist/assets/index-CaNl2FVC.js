(function(){const se=document.createElement("link").relList;if(se&&se.supports&&se.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))N(a);new MutationObserver(a=>{for(const k of a)if(k.type==="childList")for(const j of k.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&N(j)}).observe(document,{childList:!0,subtree:!0});function ae(a){const k={};return a.integrity&&(k.integrity=a.integrity),a.referrerPolicy&&(k.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?k.credentials="include":a.crossOrigin==="anonymous"?k.credentials="omit":k.credentials="same-origin",k}function N(a){if(a.ep)return;a.ep=!0;const k=ae(a);fetch(a.href,k)}})();function an(B,se,ae,N){const a=document.createElement("div");a.className="search-results",B.parentNode.style.position="relative",B.parentNode.appendChild(a);async function k(j){if(a.innerHTML="",!!j)try{const{hits:W}=await se.search(j,{hitsPerPage:5});W.forEach(H=>{const $=document.createElement("div");$.className="search-result";const J=H.name||`Song #${H.token_id}`;$.textContent=J,$.addEventListener("click",()=>{a.innerHTML="",B.value="",ae&&ae(parseInt(H.objectID,10))}),a.appendChild($)})}catch(W){console.error("Search error",W)}}B.addEventListener("input",j=>{k(j.target.value.trim())}),B.addEventListener("keydown",j=>{if(j.key==="Enter"){j.preventDefault();const W=B.value.trim();if(a.innerHTML="",N)N(W);else{const H=a.querySelector(".search-result");H&&H.click()}}})}var sn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function cn(B){return B&&B.__esModule&&Object.prototype.hasOwnProperty.call(B,"default")?B.default:B}var Qt={exports:{}};/*! algoliasearch.umd.js | 4.24.0 | Â© Algolia, inc. | https://github.com/algolia/algoliasearch-client-javascript */(function(B,se){(function(ae,N){B.exports=N()})(sn,function(){function ae(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?N(Object(n),!0).forEach(function(r){ae(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function k(e,t){if(e==null)return{};var n,r,o=function(w,f){if(w==null)return{};var b,P,S={},D=Object.keys(w);for(P=0;P<D.length;P++)b=D[P],f.indexOf(b)>=0||(S[b]=w[b]);return S}(e,t);if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(e);for(r=0;r<y.length;r++)n=y[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function j(e,t){return function(n){if(Array.isArray(n))return n}(e)||function(n,r){if(Symbol.iterator in Object(n)||Object.prototype.toString.call(n)==="[object Arguments]"){var o=[],y=!0,w=!1,f=void 0;try{for(var b,P=n[Symbol.iterator]();!(y=(b=P.next()).done)&&(o.push(b.value),!r||o.length!==r);y=!0);}catch(S){w=!0,f=S}finally{try{y||P.return==null||P.return()}finally{if(w)throw f}}return o}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function W(e){return function(t){if(Array.isArray(t)){for(var n=0,r=new Array(t.length);n<t.length;n++)r[n]=t[n];return r}}(e)||function(t){if(Symbol.iterator in Object(t)||Object.prototype.toString.call(t)==="[object Arguments]")return Array.from(t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function H(e){var t,n="algoliasearch-client-js-".concat(e.key),r=function(){return t===void 0&&(t=e.localStorage||window.localStorage),t},o=function(){return JSON.parse(r().getItem(n)||"{}")},y=function(f){r().setItem(n,JSON.stringify(f))},w=function(){var f=e.timeToLive?1e3*e.timeToLive:null,b=o(),P=Object.fromEntries(Object.entries(b).filter(function(D){return j(D,2)[1].timestamp!==void 0}));if(y(P),f){var S=Object.fromEntries(Object.entries(P).filter(function(D){var L=j(D,2)[1],U=new Date().getTime();return!(L.timestamp+f<U)}));y(S)}};return{get:function(f,b){var P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{miss:function(){return Promise.resolve()}};return Promise.resolve().then(function(){w();var S=JSON.stringify(f);return o()[S]}).then(function(S){return Promise.all([S?S.value:b(),S!==void 0])}).then(function(S){var D=j(S,2),L=D[0],U=D[1];return Promise.all([L,U||P.miss(L)])}).then(function(S){return j(S,1)[0]})},set:function(f,b){return Promise.resolve().then(function(){var P=o();return P[JSON.stringify(f)]={timestamp:new Date().getTime(),value:b},r().setItem(n,JSON.stringify(P)),b})},delete:function(f){return Promise.resolve().then(function(){var b=o();delete b[JSON.stringify(f)],r().setItem(n,JSON.stringify(b))})},clear:function(){return Promise.resolve().then(function(){r().removeItem(n)})}}}function $(e){var t=W(e.caches),n=t.shift();return n===void 0?{get:function(r,o){var y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{miss:function(){return Promise.resolve()}},w=o();return w.then(function(f){return Promise.all([f,y.miss(f)])}).then(function(f){return j(f,1)[0]})},set:function(r,o){return Promise.resolve(o)},delete:function(r){return Promise.resolve()},clear:function(){return Promise.resolve()}}:{get:function(r,o){var y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{miss:function(){return Promise.resolve()}};return n.get(r,o,y).catch(function(){return $({caches:t}).get(r,o,y)})},set:function(r,o){return n.set(r,o).catch(function(){return $({caches:t}).set(r,o)})},delete:function(r){return n.delete(r).catch(function(){return $({caches:t}).delete(r)})},clear:function(){return n.clear().catch(function(){return $({caches:t}).clear()})}}}function J(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{serializable:!0},t={};return{get:function(n,r){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{miss:function(){return Promise.resolve()}},y=JSON.stringify(n);if(y in t)return Promise.resolve(e.serializable?JSON.parse(t[y]):t[y]);var w=r(),f=o&&o.miss||function(){return Promise.resolve()};return w.then(function(b){return f(b)}).then(function(){return w})},set:function(n,r){return t[JSON.stringify(n)]=e.serializable?JSON.stringify(r):r,Promise.resolve(r)},delete:function(n){return delete t[JSON.stringify(n)],Promise.resolve()},clear:function(){return t={},Promise.resolve()}}}function Y(e,t,n){var r={"x-algolia-api-key":n,"x-algolia-application-id":t};return{headers:function(){return e===z.WithinHeaders?r:{}},queryParameters:function(){return e===z.WithinQueryParameters?r:{}}}}function te(e){var t=0;return e(function n(){return t++,new Promise(function(r){setTimeout(function(){r(e(n))},Math.min(100*t,1e3))})})}function R(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(n,r){return Promise.resolve()};return Object.assign(e,{wait:function(n){return R(e.then(function(r){return Promise.all([t(r,n),r])}).then(function(r){return r[1]}))}})}function ne(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[n],e[n]=r}return e}function Q(e,t){return t&&Object.keys(t).forEach(function(n){e[n]=t[n](e)}),e}function s(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=0;return e.replace(/%s/g,function(){return encodeURIComponent(n[o++])})}var z={WithinQueryParameters:0,WithinHeaders:1};function re(e,t){var n=e||{},r=n.data||{};return Object.keys(n).forEach(function(o){["timeout","headers","queryParameters","data","cacheable"].indexOf(o)===-1&&(r[o]=n[o])}),{data:Object.entries(r).length>0?r:void 0,timeout:n.timeout||t,headers:n.headers||{},queryParameters:n.queryParameters||{},cacheable:n.cacheable}}var G={Read:1,Write:2,Any:3},X=1,$e=2,q=3;function de(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:X;return a(a({},e),{},{status:t,lastUpdate:Date.now()})}function fe(e){return typeof e=="string"?{protocol:"https",url:e,accept:G.Any}:{protocol:e.protocol||"https",url:e.url,accept:e.accept||G.Any}}var ce="DELETE",_="GET",C="POST",nt="PUT";function bt(e,t){return Promise.all(t.map(function(n){return e.get(n,function(){return Promise.resolve(de(n))})})).then(function(n){var r=n.filter(function(w){return function(f){return f.status===X||Date.now()-f.lastUpdate>12e4}(w)}),o=n.filter(function(w){return function(f){return f.status===q&&Date.now()-f.lastUpdate<=12e4}(w)}),y=[].concat(W(r),W(o));return{getTimeout:function(w,f){return(o.length===0&&w===0?1:o.length+3+w)*f},statelessHosts:y.length>0?y.map(function(w){return fe(w)}):t}})}function rt(e,t,n,r){var o=[],y=function(L,U){if(!(L.method===_||L.data===void 0&&U.data===void 0)){var M=Array.isArray(L.data)?L.data:a(a({},L.data),U.data);return JSON.stringify(M)}}(n,r),w=function(L,U){var M=a(a({},L.headers),U.headers),Z={};return Object.keys(M).forEach(function(ie){var ye=M[ie];Z[ie.toLowerCase()]=ye}),Z}(e,r),f=n.method,b=n.method!==_?{}:a(a({},n.data),r.data),P=a(a(a({"x-algolia-agent":e.userAgent.value},e.queryParameters),b),r.queryParameters),S=0,D=function L(U,M){var Z=U.pop();if(Z===void 0)throw{name:"RetryError",message:"Unreachable hosts - your application id may be incorrect. If the error persists, please reach out to the Algolia Support team: https://alg.li/support .",transporterStackTrace:Oe(o)};var ie={data:y,headers:w,method:f,url:wt(Z,n.path,P),connectTimeout:M(S,e.timeouts.connect),responseTimeout:M(S,r.timeout)},ye=function(ve){var me={request:ie,response:ve,host:Z,triesLeft:U.length};return o.push(me),me},yt={onSuccess:function(ve){return function(me){try{return JSON.parse(me.content)}catch(tt){throw function(Ye,lt){return{name:"DeserializationError",message:Ye,response:lt}}(tt.message,me)}}(ve)},onRetry:function(ve){var me=ye(ve);return ve.isTimedOut&&S++,Promise.all([e.logger.info("Retryable failure",xt(me)),e.hostsCache.set(Z,de(Z,ve.isTimedOut?q:$e))]).then(function(){return L(U,M)})},onFail:function(ve){throw ye(ve),function(me,tt){var Ye=me.content,lt=me.status,vt=Ye;try{vt=JSON.parse(Ye).message}catch{}return function(Nt,Gt,on){return{name:"ApiError",message:Nt,status:Gt,transporterStackTrace:on}}(vt,lt,tt)}(ve,Oe(o))}};return e.requester.send(ie).then(function(ve){return function(me,tt){return function(Ye){var lt=Ye.status;return Ye.isTimedOut||function(vt){var Nt=vt.isTimedOut,Gt=vt.status;return!Nt&&~~Gt==0}(Ye)||~~(lt/100)!=2&&~~(lt/100)!=4}(me)?tt.onRetry(me):~~(me.status/100)==2?tt.onSuccess(me):tt.onFail(me)}(ve,yt)})};return bt(e.hostsCache,t).then(function(L){return D(W(L.statelessHosts).reverse(),L.getTimeout)})}function ot(e){var t=e.hostsCache,n=e.logger,r=e.requester,o=e.requestsCache,y=e.responsesCache,w=e.timeouts,f=e.userAgent,b=e.hosts,P=e.queryParameters,S={hostsCache:t,logger:n,requester:r,requestsCache:o,responsesCache:y,timeouts:w,userAgent:f,headers:e.headers,queryParameters:P,hosts:b.map(function(D){return fe(D)}),read:function(D,L){var U=re(L,S.timeouts.read),M=function(){return rt(S,S.hosts.filter(function(ie){return(ie.accept&G.Read)!=0}),D,U)};if((U.cacheable!==void 0?U.cacheable:D.cacheable)!==!0)return M();var Z={request:D,mappedRequestOptions:U,transporter:{queryParameters:S.queryParameters,headers:S.headers}};return S.responsesCache.get(Z,function(){return S.requestsCache.get(Z,function(){return S.requestsCache.set(Z,M()).then(function(ie){return Promise.all([S.requestsCache.delete(Z),ie])},function(ie){return Promise.all([S.requestsCache.delete(Z),Promise.reject(ie)])}).then(function(ie){var ye=j(ie,2);return ye[0],ye[1]})})},{miss:function(ie){return S.responsesCache.set(Z,ie)}})},write:function(D,L){return rt(S,S.hosts.filter(function(U){return(U.accept&G.Write)!=0}),D,re(L,S.timeouts.write))}};return S}function ut(e){var t={value:"Algolia for JavaScript (".concat(e,")"),add:function(n){var r="; ".concat(n.segment).concat(n.version!==void 0?" (".concat(n.version,")"):"");return t.value.indexOf(r)===-1&&(t.value="".concat(t.value).concat(r)),t}};return t}function wt(e,t,n){var r=_e(n),o="".concat(e.protocol,"://").concat(e.url,"/").concat(t.charAt(0)==="/"?t.substr(1):t);return r.length&&(o+="?".concat(r)),o}function _e(e){return Object.keys(e).map(function(t){return s("%s=%s",t,(n=e[t],Object.prototype.toString.call(n)==="[object Object]"||Object.prototype.toString.call(n)==="[object Array]"?JSON.stringify(e[t]):e[t]));var n}).join("&")}function Oe(e){return e.map(function(t){return xt(t)})}function xt(e){var t=e.request.headers["x-algolia-api-key"]?{"x-algolia-api-key":"*****"}:{};return a(a({},e),{},{request:a(a({},e.request),{},{headers:a(a({},e.request.headers),t)})})}var Pe=function(e){return function(t,n){return e.transporter.write({method:C,path:"2/abtests",data:t},n)}},Qe=function(e){return function(t,n){return e.transporter.write({method:ce,path:s("2/abtests/%s",t)},n)}},V=function(e){return function(t,n){return e.transporter.read({method:_,path:s("2/abtests/%s",t)},n)}},St=function(e){return function(t){return e.transporter.read({method:_,path:"2/abtests"},t)}},Me=function(e){return function(t,n){return e.transporter.write({method:C,path:s("2/abtests/%s/stop",t)},n)}},Be=function(e){return function(t){return e.transporter.read({method:_,path:"1/strategies/personalization"},t)}},Fe=function(e){return function(t,n){return e.transporter.write({method:C,path:"1/strategies/personalization",data:t},n)}};function it(e){return function t(n){return e.request(n).then(function(r){if(e.batch!==void 0&&e.batch(r.hits),!e.shouldStop(r))return r.cursor?t({cursor:r.cursor}):t({page:(n.page||0)+1})})}({})}var Et=function(e){return function(t,n){var r=n||{},o=r.queryParameters,y=k(r,["queryParameters"]),w=a({acl:t},o!==void 0?{queryParameters:o}:{});return R(e.transporter.write({method:C,path:"1/keys",data:w},y),function(f,b){return te(function(P){return Te(e)(f.key,b).catch(function(S){if(S.status!==404)throw S;return P()})})})}},Se=function(e){return function(t,n,r){var o=re(r);return o.queryParameters["X-Algolia-User-ID"]=t,e.transporter.write({method:C,path:"1/clusters/mapping",data:{cluster:n}},o)}},$t=function(e){return function(t,n,r){return e.transporter.write({method:C,path:"1/clusters/mapping/batch",data:{users:t,cluster:n}},r)}},He=function(e){return function(t,n){return R(e.transporter.write({method:C,path:s("/1/dictionaries/%s/batch",t),data:{clearExistingDictionaryEntries:!0,requests:{action:"addEntry",body:[]}}},n),function(r,o){return x(e)(r.taskID,o)})}},at=function(e){return function(t,n,r){return R(e.transporter.write({method:C,path:s("1/indexes/%s/operation",t),data:{operation:"copy",destination:n}},r),function(o,y){return Re(e)(t,{methods:{waitTask:ee}}).waitTask(o.taskID,y)})}},dt=function(e){return function(t,n,r){return at(e)(t,n,a(a({},r),{},{scope:[gt.Rules]}))}},Ee=function(e){return function(t,n,r){return at(e)(t,n,a(a({},r),{},{scope:[gt.Settings]}))}},ft=function(e){return function(t,n,r){return at(e)(t,n,a(a({},r),{},{scope:[gt.Synonyms]}))}},_t=function(e){return function(t,n){return t.method===_?e.transporter.read(t,n):e.transporter.write(t,n)}},It=function(e){return function(t,n){return R(e.transporter.write({method:ce,path:s("1/keys/%s",t)},n),function(r,o){return te(function(y){return Te(e)(t,o).then(y).catch(function(w){if(w.status!==404)throw w})})})}},Ot=function(e){return function(t,n,r){var o=n.map(function(y){return{action:"deleteEntry",body:{objectID:y}}});return R(e.transporter.write({method:C,path:s("/1/dictionaries/%s/batch",t),data:{clearExistingDictionaryEntries:!1,requests:o}},r),function(y,w){return x(e)(y.taskID,w)})}},Te=function(e){return function(t,n){return e.transporter.read({method:_,path:s("1/keys/%s",t)},n)}},pt=function(e){return function(t,n){return e.transporter.read({method:_,path:s("1/task/%s",t.toString())},n)}},Pt=function(e){return function(t){return e.transporter.read({method:_,path:"/1/dictionaries/*/settings"},t)}},kt=function(e){return function(t){return e.transporter.read({method:_,path:"1/logs"},t)}},Tt=function(e){return function(t){return e.transporter.read({method:_,path:"1/clusters/mapping/top"},t)}},Mt=function(e){return function(t,n){return e.transporter.read({method:_,path:s("1/clusters/mapping/%s",t)},n)}},Rt=function(e){return function(t){var n=t||{},r=n.retrieveMappings,o=k(n,["retrieveMappings"]);return r===!0&&(o.getClusters=!0),e.transporter.read({method:_,path:"1/clusters/mapping/pending"},o)}},Re=function(e){return function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r={transporter:e.transporter,appId:e.appId,indexName:t};return Q(r,n.methods)}},mt=function(e){return function(t){return e.transporter.read({method:_,path:"1/keys"},t)}},Ct=function(e){return function(t){return e.transporter.read({method:_,path:"1/clusters"},t)}},At=function(e){return function(t){return e.transporter.read({method:_,path:"1/indexes"},t)}},Lt=function(e){return function(t){return e.transporter.read({method:_,path:"1/clusters/mapping"},t)}},Bt=function(e){return function(t,n,r){return R(e.transporter.write({method:C,path:s("1/indexes/%s/operation",t),data:{operation:"move",destination:n}},r),function(o,y){return Re(e)(t,{methods:{waitTask:ee}}).waitTask(o.taskID,y)})}},Ft=function(e){return function(t,n){return R(e.transporter.write({method:C,path:"1/indexes/*/batch",data:{requests:t}},n),function(r,o){return Promise.all(Object.keys(r.taskID).map(function(y){return Re(e)(y,{methods:{waitTask:ee}}).waitTask(r.taskID[y],o)}))})}},Ht=function(e){return function(t,n){return e.transporter.read({method:C,path:"1/indexes/*/objects",data:{requests:t}},n)}},Dt=function(e){return function(t,n){var r=t.map(function(o){return a(a({},o),{},{params:_e(o.params||{})})});return e.transporter.read({method:C,path:"1/indexes/*/queries",data:{requests:r},cacheable:!0},n)}},ze=function(e){return function(t,n){return Promise.all(t.map(function(r){var o=r.params,y=o.facetName,w=o.facetQuery,f=k(o,["facetName","facetQuery"]);return Re(e)(r.indexName,{methods:{searchForFacetValues:K}}).searchForFacetValues(y,w,a(a({},n),f))}))}},ht=function(e){return function(t,n){var r=re(n);return r.queryParameters["X-Algolia-User-ID"]=t,e.transporter.write({method:ce,path:"1/clusters/mapping"},r)}},jt=function(e){return function(t,n,r){var o=n.map(function(y){return{action:"addEntry",body:y}});return R(e.transporter.write({method:C,path:s("/1/dictionaries/%s/batch",t),data:{clearExistingDictionaryEntries:!0,requests:o}},r),function(y,w){return x(e)(y.taskID,w)})}},zt=function(e){return function(t,n){return R(e.transporter.write({method:C,path:s("1/keys/%s/restore",t)},n),function(r,o){return te(function(y){return Te(e)(t,o).catch(function(w){if(w.status!==404)throw w;return y()})})})}},i=function(e){return function(t,n,r){var o=n.map(function(y){return{action:"addEntry",body:y}});return R(e.transporter.write({method:C,path:s("/1/dictionaries/%s/batch",t),data:{clearExistingDictionaryEntries:!1,requests:o}},r),function(y,w){return x(e)(y.taskID,w)})}},m=function(e){return function(t,n,r){return e.transporter.read({method:C,path:s("/1/dictionaries/%s/search",t),data:{query:n},cacheable:!0},r)}},c=function(e){return function(t,n){return e.transporter.read({method:C,path:"1/clusters/mapping/search",data:{query:t}},n)}},d=function(e){return function(t,n){return R(e.transporter.write({method:nt,path:"/1/dictionaries/*/settings",data:t},n),function(r,o){return x(e)(r.taskID,o)})}},p=function(e){return function(t,n){var r=Object.assign({},n),o=n||{},y=o.queryParameters,w=k(o,["queryParameters"]),f=y?{queryParameters:y}:{},b=["acl","indexes","referers","restrictSources","queryParameters","description","maxQueriesPerIPPerHour","maxHitsPerQuery"];return R(e.transporter.write({method:nt,path:s("1/keys/%s",t),data:f},w),function(P,S){return te(function(D){return Te(e)(t,S).then(function(L){return function(U){return Object.keys(r).filter(function(M){return b.indexOf(M)!==-1}).every(function(M){if(Array.isArray(U[M])&&Array.isArray(r[M])){var Z=U[M];return Z.length===r[M].length&&Z.every(function(ie,ye){return ie===r[M][ye]})}return U[M]===r[M]})}(L)?Promise.resolve():D()})})})}},x=function(e){return function(t,n){return te(function(r){return pt(e)(t,n).then(function(o){return o.status!=="published"?r():void 0})})}},E=function(e){return function(t,n){return R(e.transporter.write({method:C,path:s("1/indexes/%s/batch",e.indexName),data:{requests:t}},n),function(r,o){return ee(e)(r.taskID,o)})}},I=function(e){return function(t){return it(a(a({shouldStop:function(n){return n.cursor===void 0}},t),{},{request:function(n){return e.transporter.read({method:C,path:s("1/indexes/%s/browse",e.indexName),data:n},t)}}))}},h=function(e){return function(t){var n=a({hitsPerPage:1e3},t);return it(a(a({shouldStop:function(r){return r.hits.length<n.hitsPerPage}},n),{},{request:function(r){return Je(e)("",a(a({},n),r)).then(function(o){return a(a({},o),{},{hits:o.hits.map(function(y){return delete y._highlightResult,y})})})}}))}},l=function(e){return function(t){var n=a({hitsPerPage:1e3},t);return it(a(a({shouldStop:function(r){return r.hits.length<n.hitsPerPage}},n),{},{request:function(r){return xe(e)("",a(a({},n),r)).then(function(o){return a(a({},o),{},{hits:o.hits.map(function(y){return delete y._highlightResult,y})})})}}))}},u=function(e){return function(t,n,r){var o=r||{},y=o.batchSize,w=k(o,["batchSize"]),f={taskIDs:[],objectIDs:[]};return R(function b(){var P,S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,D=[];for(P=S;P<t.length&&(D.push(t[P]),D.length!==(y||1e3));P++);return D.length===0?Promise.resolve(f):E(e)(D.map(function(L){return{action:n,body:L}}),w).then(function(L){return f.objectIDs=f.objectIDs.concat(L.objectIDs),f.taskIDs.push(L.taskID),P++,b(P)})}(),function(b,P){return Promise.all(b.taskIDs.map(function(S){return ee(e)(S,P)}))})}},g=function(e){return function(t){return R(e.transporter.write({method:C,path:s("1/indexes/%s/clear",e.indexName)},t),function(n,r){return ee(e)(n.taskID,r)})}},v=function(e){return function(t){var n=t||{},r=n.forwardToReplicas,o=re(k(n,["forwardToReplicas"]));return r&&(o.queryParameters.forwardToReplicas=1),R(e.transporter.write({method:C,path:s("1/indexes/%s/rules/clear",e.indexName)},o),function(y,w){return ee(e)(y.taskID,w)})}},O=function(e){return function(t){var n=t||{},r=n.forwardToReplicas,o=re(k(n,["forwardToReplicas"]));return r&&(o.queryParameters.forwardToReplicas=1),R(e.transporter.write({method:C,path:s("1/indexes/%s/synonyms/clear",e.indexName)},o),function(y,w){return ee(e)(y.taskID,w)})}},F=function(e){return function(t,n){return R(e.transporter.write({method:C,path:s("1/indexes/%s/deleteByQuery",e.indexName),data:t},n),function(r,o){return ee(e)(r.taskID,o)})}},T=function(e){return function(t){return R(e.transporter.write({method:ce,path:s("1/indexes/%s",e.indexName)},t),function(n,r){return ee(e)(n.taskID,r)})}},A=function(e){return function(t,n){return R(le(e)([t],n).then(function(r){return{taskID:r.taskIDs[0]}}),function(r,o){return ee(e)(r.taskID,o)})}},le=function(e){return function(t,n){var r=t.map(function(o){return{objectID:o}});return u(e)(r,Ke.DeleteObject,n)}},he=function(e){return function(t,n){var r=n||{},o=r.forwardToReplicas,y=re(k(r,["forwardToReplicas"]));return o&&(y.queryParameters.forwardToReplicas=1),R(e.transporter.write({method:ce,path:s("1/indexes/%s/rules/%s",e.indexName,t)},y),function(w,f){return ee(e)(w.taskID,f)})}},pe=function(e){return function(t,n){var r=n||{},o=r.forwardToReplicas,y=re(k(r,["forwardToReplicas"]));return o&&(y.queryParameters.forwardToReplicas=1),R(e.transporter.write({method:ce,path:s("1/indexes/%s/synonyms/%s",e.indexName,t)},y),function(w,f){return ee(e)(w.taskID,f)})}},oe=function(e){return function(t){return Ie(e)(t).then(function(){return!0}).catch(function(n){if(n.status!==404)throw n;return!1})}},ue=function(e){return function(t,n,r){return e.transporter.read({method:C,path:s("1/answers/%s/prediction",e.indexName),data:{query:t,queryLanguages:n},cacheable:!0},r)}},ke=function(e){return function(t,n){var r=n||{},o=r.query,y=r.paginate,w=k(r,["query","paginate"]),f=0;return function b(){return et(e)(o||"",a(a({},w),{},{page:f})).then(function(P){for(var S=0,D=Object.entries(P.hits);S<D.length;S++){var L=j(D[S],2),U=L[0],M=L[1];if(t(M))return{object:M,position:parseInt(U,10),page:f}}if(f++,y===!1||f>=P.nbPages)throw{name:"ObjectNotFoundError",message:"Object not found."};return b()})}()}},be=function(e){return function(t,n){return e.transporter.read({method:_,path:s("1/indexes/%s/%s",e.indexName,t)},n)}},Ce=function(){return function(e,t){for(var n=0,r=Object.entries(e.hits);n<r.length;n++){var o=j(r[n],2),y=o[0];if(o[1].objectID===t)return parseInt(y,10)}return-1}},Ae=function(e){return function(t,n){var r=n||{},o=r.attributesToRetrieve,y=k(r,["attributesToRetrieve"]),w=t.map(function(f){return a({indexName:e.indexName,objectID:f},o?{attributesToRetrieve:o}:{})});return e.transporter.read({method:C,path:"1/indexes/*/objects",data:{requests:w}},y)}},Le=function(e){return function(t,n){return e.transporter.read({method:_,path:s("1/indexes/%s/rules/%s",e.indexName,t)},n)}},Ie=function(e){return function(t){return e.transporter.read({method:_,path:s("1/indexes/%s/settings",e.indexName),data:{getVersion:2}},t)}},Ve=function(e){return function(t,n){return e.transporter.read({method:_,path:s("1/indexes/%s/synonyms/%s",e.indexName,t)},n)}},Xe=function(e){return function(t,n){return R(Ue(e)([t],n).then(function(r){return{objectID:r.objectIDs[0],taskID:r.taskIDs[0]}}),function(r,o){return ee(e)(r.taskID,o)})}},Ue=function(e){return function(t,n){var r=n||{},o=r.createIfNotExists,y=k(r,["createIfNotExists"]),w=o?Ke.PartialUpdateObject:Ke.PartialUpdateObjectNoCreate;return u(e)(t,w,y)}},De=function(e){return function(t,n){var r=n||{},o=r.safe,y=r.autoGenerateObjectIDIfNotExist,w=r.batchSize,f=k(r,["safe","autoGenerateObjectIDIfNotExist","batchSize"]),b=function(M,Z,ie,ye){return R(e.transporter.write({method:C,path:s("1/indexes/%s/operation",M),data:{operation:ie,destination:Z}},ye),function(yt,ve){return ee(e)(yt.taskID,ve)})},P=Math.random().toString(36).substring(7),S="".concat(e.indexName,"_tmp_").concat(P),D=Ge({appId:e.appId,transporter:e.transporter,indexName:S}),L=[],U=b(e.indexName,S,"copy",a(a({},f),{},{scope:["settings","synonyms","rules"]}));return L.push(U),R((o?U.wait(f):U).then(function(){var M=D(t,a(a({},f),{},{autoGenerateObjectIDIfNotExist:y,batchSize:w}));return L.push(M),o?M.wait(f):M}).then(function(){var M=b(S,e.indexName,"move",f);return L.push(M),o?M.wait(f):M}).then(function(){return Promise.all(L)}).then(function(M){var Z=j(M,3),ie=Z[0],ye=Z[1],yt=Z[2];return{objectIDs:ye.objectIDs,taskIDs:[ie.taskID].concat(W(ye.taskIDs),[yt.taskID])}}),function(M,Z){return Promise.all(L.map(function(ie){return ie.wait(Z)}))})}},je=function(e){return function(t,n){return ge(e)(t,a(a({},n),{},{clearExistingRules:!0}))}},Ze=function(e){return function(t,n){return We(e)(t,a(a({},n),{},{clearExistingSynonyms:!0}))}},we=function(e){return function(t,n){return R(Ge(e)([t],n).then(function(r){return{objectID:r.objectIDs[0],taskID:r.taskIDs[0]}}),function(r,o){return ee(e)(r.taskID,o)})}},Ge=function(e){return function(t,n){var r=n||{},o=r.autoGenerateObjectIDIfNotExist,y=k(r,["autoGenerateObjectIDIfNotExist"]),w=o?Ke.AddObject:Ke.UpdateObject;if(w===Ke.UpdateObject){var f=!0,b=!1,P=void 0;try{for(var S,D=t[Symbol.iterator]();!(f=(S=D.next()).done);f=!0)if(S.value.objectID===void 0)return R(Promise.reject({name:"MissingObjectIDError",message:"All objects must have an unique objectID (like a primary key) to be valid. Algolia is also able to generate objectIDs automatically but *it's not recommended*. To do it, use the `{'autoGenerateObjectIDIfNotExist': true}` option."}))}catch(L){b=!0,P=L}finally{try{f||D.return==null||D.return()}finally{if(b)throw P}}}return u(e)(t,w,y)}},st=function(e){return function(t,n){return ge(e)([t],n)}},ge=function(e){return function(t,n){var r=n||{},o=r.forwardToReplicas,y=r.clearExistingRules,w=re(k(r,["forwardToReplicas","clearExistingRules"]));return o&&(w.queryParameters.forwardToReplicas=1),y&&(w.queryParameters.clearExistingRules=1),R(e.transporter.write({method:C,path:s("1/indexes/%s/rules/batch",e.indexName),data:t},w),function(f,b){return ee(e)(f.taskID,b)})}},qe=function(e){return function(t,n){return We(e)([t],n)}},We=function(e){return function(t,n){var r=n||{},o=r.forwardToReplicas,y=r.clearExistingSynonyms,w=r.replaceExistingSynonyms,f=re(k(r,["forwardToReplicas","clearExistingSynonyms","replaceExistingSynonyms"]));return o&&(f.queryParameters.forwardToReplicas=1),(w||y)&&(f.queryParameters.replaceExistingSynonyms=1),R(e.transporter.write({method:C,path:s("1/indexes/%s/synonyms/batch",e.indexName),data:t},f),function(b,P){return ee(e)(b.taskID,P)})}},et=function(e){return function(t,n){return e.transporter.read({method:C,path:s("1/indexes/%s/query",e.indexName),data:{query:t},cacheable:!0},n)}},K=function(e){return function(t,n,r){return e.transporter.read({method:C,path:s("1/indexes/%s/facets/%s/query",e.indexName,t),data:{facetQuery:n},cacheable:!0},r)}},Je=function(e){return function(t,n){return e.transporter.read({method:C,path:s("1/indexes/%s/rules/search",e.indexName),data:{query:t}},n)}},xe=function(e){return function(t,n){return e.transporter.read({method:C,path:s("1/indexes/%s/synonyms/search",e.indexName),data:{query:t}},n)}},Ne=function(e){return function(t,n){var r=n||{},o=r.forwardToReplicas,y=re(k(r,["forwardToReplicas"]));return o&&(y.queryParameters.forwardToReplicas=1),R(e.transporter.write({method:nt,path:s("1/indexes/%s/settings",e.indexName),data:t},y),function(w,f){return ee(e)(w.taskID,f)})}},ee=function(e){return function(t,n){return te(function(r){return function(o){return function(y,w){return o.transporter.read({method:_,path:s("1/indexes/%s/task/%s",o.indexName,y.toString())},w)}}(e)(t,n).then(function(o){return o.status!=="published"?r():void 0})})}},Ke={AddObject:"addObject",UpdateObject:"updateObject",PartialUpdateObject:"partialUpdateObject",PartialUpdateObjectNoCreate:"partialUpdateObjectNoCreate",DeleteObject:"deleteObject"},gt={Settings:"settings",Synonyms:"synonyms",Rules:"rules"},Vt=1,Ut=2,ct=3,qt=function(e){return function(t,n){var r=t.map(function(o){return a(a({},o),{},{threshold:o.threshold||0})});return e.transporter.read({method:C,path:"1/indexes/*/recommendations",data:{requests:r},cacheable:!0},n)}},Xt=function(e){return function(t,n){return qt(e)(t.map(function(r){return a(a({},r),{},{fallbackParameters:{},model:"bought-together"})}),n)}},Zt=function(e){return function(t,n){return qt(e)(t.map(function(r){return a(a({},r),{},{model:"related-products"})}),n)}},en=function(e){return function(t,n){var r=t.map(function(o){return a(a({},o),{},{model:"trending-facets",threshold:o.threshold||0})});return e.transporter.read({method:C,path:"1/indexes/*/recommendations",data:{requests:r},cacheable:!0},n)}},tn=function(e){return function(t,n){var r=t.map(function(o){return a(a({},o),{},{model:"trending-items",threshold:o.threshold||0})});return e.transporter.read({method:C,path:"1/indexes/*/recommendations",data:{requests:r},cacheable:!0},n)}},nn=function(e){return function(t,n){return qt(e)(t.map(function(r){return a(a({},r),{},{model:"looking-similar"})}),n)}},rn=function(e){return function(t,n){var r=t.map(function(o){return a(a({},o),{},{model:"recommended-for-you",threshold:o.threshold||0})});return e.transporter.read({method:C,path:"1/indexes/*/recommendations",data:{requests:r},cacheable:!0},n)}};function Jt(e,t,n){var r,o={appId:e,apiKey:t,timeouts:{connect:1,read:2,write:30},requester:{send:function(f){return new Promise(function(b){var P=new XMLHttpRequest;P.open(f.method,f.url,!0),Object.keys(f.headers).forEach(function(U){return P.setRequestHeader(U,f.headers[U])});var S,D=function(U,M){return setTimeout(function(){P.abort(),b({status:0,content:M,isTimedOut:!0})},1e3*U)},L=D(f.connectTimeout,"Connection timeout");P.onreadystatechange=function(){P.readyState>P.OPENED&&S===void 0&&(clearTimeout(L),S=D(f.responseTimeout,"Socket timeout"))},P.onerror=function(){P.status===0&&(clearTimeout(L),clearTimeout(S),b({content:P.responseText||"Network request failed",status:P.status,isTimedOut:!1}))},P.onload=function(){clearTimeout(L),clearTimeout(S),b({content:P.responseText,status:P.status,isTimedOut:!1})},P.send(f.data)})}},logger:(r=ct,{debug:function(f,b){return Vt>=r&&console.debug(f,b),Promise.resolve()},info:function(f,b){return Ut>=r&&console.info(f,b),Promise.resolve()},error:function(f,b){return console.error(f,b),Promise.resolve()}}),responsesCache:J(),requestsCache:J({serializable:!1}),hostsCache:$({caches:[H({key:"".concat("4.24.0","-").concat(e)}),J()]}),userAgent:ut("4.24.0").add({segment:"Browser"})},y=a(a({},o),n),w=function(){return function(f){return function(b){var P=b.region||"us",S=Y(z.WithinHeaders,b.appId,b.apiKey),D=ot(a(a({hosts:[{url:"personalization.".concat(P,".algolia.com")}]},b),{},{headers:a(a(a({},S.headers()),{"content-type":"application/json"}),b.headers),queryParameters:a(a({},S.queryParameters()),b.queryParameters)}));return Q({appId:b.appId,transporter:D},b.methods)}(a(a(a({},o),f),{},{methods:{getPersonalizationStrategy:Be,setPersonalizationStrategy:Fe}}))}};return function(f){var b=f.appId,P=Y(f.authMode!==void 0?f.authMode:z.WithinHeaders,b,f.apiKey),S=ot(a(a({hosts:[{url:"".concat(b,"-dsn.algolia.net"),accept:G.Read},{url:"".concat(b,".algolia.net"),accept:G.Write}].concat(ne([{url:"".concat(b,"-1.algolianet.com")},{url:"".concat(b,"-2.algolianet.com")},{url:"".concat(b,"-3.algolianet.com")}]))},f),{},{headers:a(a(a({},P.headers()),{"content-type":"application/x-www-form-urlencoded"}),f.headers),queryParameters:a(a({},P.queryParameters()),f.queryParameters)}));return Q({transporter:S,appId:b,addAlgoliaAgent:function(D,L){S.userAgent.add({segment:D,version:L})},clearCache:function(){return Promise.all([S.requestsCache.clear(),S.responsesCache.clear()]).then(function(){})}},f.methods)}(a(a({},y),{},{methods:{search:Dt,searchForFacetValues:ze,multipleBatch:Ft,multipleGetObjects:Ht,multipleQueries:Dt,copyIndex:at,copySettings:Ee,copySynonyms:ft,copyRules:dt,moveIndex:Bt,listIndices:At,getLogs:kt,listClusters:Ct,multipleSearchForFacetValues:ze,getApiKey:Te,addApiKey:Et,listApiKeys:mt,updateApiKey:p,deleteApiKey:It,restoreApiKey:zt,assignUserID:Se,assignUserIDs:$t,getUserID:Mt,searchUserIDs:c,listUserIDs:Lt,getTopUserIDs:Tt,removeUserID:ht,hasPendingMappings:Rt,clearDictionaryEntries:He,deleteDictionaryEntries:Ot,getDictionarySettings:Pt,getAppTask:pt,replaceDictionaryEntries:jt,saveDictionaryEntries:i,searchDictionaryEntries:m,setDictionarySettings:d,waitAppTask:x,customRequest:_t,initIndex:function(f){return function(b){return Re(f)(b,{methods:{batch:E,delete:T,findAnswers:ue,getObject:be,getObjects:Ae,saveObject:we,saveObjects:Ge,search:et,searchForFacetValues:K,waitTask:ee,setSettings:Ne,getSettings:Ie,partialUpdateObject:Xe,partialUpdateObjects:Ue,deleteObject:A,deleteObjects:le,deleteBy:F,clearObjects:g,browseObjects:I,getObjectPosition:Ce,findObject:ke,exists:oe,saveSynonym:qe,saveSynonyms:We,getSynonym:Ve,searchSynonyms:xe,browseSynonyms:l,deleteSynonym:pe,clearSynonyms:O,replaceAllObjects:De,replaceAllSynonyms:Ze,searchRules:Je,getRule:Le,deleteRule:he,saveRule:st,saveRules:ge,replaceAllRules:je,browseRules:h,clearRules:v}})}},initAnalytics:function(){return function(f){return function(b){var P=b.region||"us",S=Y(z.WithinHeaders,b.appId,b.apiKey),D=ot(a(a({hosts:[{url:"analytics.".concat(P,".algolia.com")}]},b),{},{headers:a(a(a({},S.headers()),{"content-type":"application/json"}),b.headers),queryParameters:a(a({},S.queryParameters()),b.queryParameters)}));return Q({appId:b.appId,transporter:D},b.methods)}(a(a(a({},o),f),{},{methods:{addABTest:Pe,getABTest:V,getABTests:St,stopABTest:Me,deleteABTest:Qe}}))}},initPersonalization:w,initRecommendation:function(){return function(f){return y.logger.info("The `initRecommendation` method is deprecated. Use `initPersonalization` instead."),w()(f)}},getRecommendations:qt,getFrequentlyBoughtTogether:Xt,getLookingSimilar:nn,getRecommendedForYou:rn,getRelatedProducts:Zt,getTrendingFacets:en,getTrendingItems:tn}}))}return Jt.version="4.24.0",Jt})})(Qt);var ln=Qt.exports;const un=cn(ln);function dn(B,se,ae){return un(B,se).initIndex(ae)}const fn="https://api.opensea.io/api/v2";async function Wt(B,se,ae="ethereum",N={}){const a={"X-API-KEY":se,accept:"application/json"};N.method==="POST"&&N.body&&(a["content-type"]="application/json");let k=0;const j=5,W=1e3,H=16e3;for(;k<=j;)try{const $=await fetch(`${fn}${B}`,{headers:a,...N});if(!$.ok){if($.status===429){if(k++,k>j)throw console.error(`OpenSea API Error (429): Max retries exceeded for endpoint ${B}`),new Error(`OpenSea API request failed: ${$.status} - Max retries exceeded`);const Y=Math.min(W*Math.pow(2,k-1),H),te=Y*.2*Math.random(),R=Math.floor(Y+te);console.warn(`OpenSea API (429) - Retrying endpoint ${B} in ${R}ms (attempt ${k}/${j})`),await new Promise(ne=>setTimeout(ne,R));continue}let J=$.statusText;try{const Y=await $.json();J=Y.message||(typeof Y=="string"?Y:JSON.stringify(Y)),Y.errors&&(J=Y.errors.join(", "))}catch{}throw console.error(`OpenSea API Error (${$.status}): ${J} for endpoint ${B}`),new Error(`OpenSea API request failed: ${$.status} - ${J}`)}return $.status===204?null:await $.json()}catch($){throw k>j||$.message&&!$.message.includes("OpenSea API request failed")?(console.error(`Error fetching from OpenSea endpoint ${B}:`,$),$):k===0?(console.error(`Error fetching from OpenSea endpoint ${B} (will not retry):`,$),$):(console.error(`Unhandled error during retry for OpenSea endpoint ${B}:`,$),$)}throw new Error("Exited retry loop unexpectedly in fetchOpenSeaData")}async function Kt(B,se,ae="ethereum"){try{const N=await Wt(`/chain/${ae}/contract/${B}`,se,ae);if(N&&N.collection)return N.collection;throw new Error("Could not retrieve collection slug from contract data.")}catch(N){throw console.error(`Error fetching collection slug for ${B}:`,N),N}}async function Yt(B,se,ae="ethereum",N=null,a=50){if(!B)throw console.error("Collection slug and API key are required to fetch activity."),new Error("Collection slug and API key are required.");try{const k=Math.min(a,50);let j=`/events/collection/${B}?limit=${k}`;return N&&(j+=`&event_type=${N}`),(await Wt(j,se,ae)).asset_events||[]}catch(k){throw console.error(`Error fetching activity for slug ${B}:`,k),k}}async function pn(B,se,ae="ethereum",N=100,a=20,k=null,j=10,W=null){var Y;const H=[];let $=null,J=0;do{if(W){const ne=J/a,Q=`Fetching page ${J+1}${a?` of ${a}`:""}...`;W(ne,Q)}const te=$?`/listings/collection/${B}/all?limit=${Math.min(N,100)}&cursor=${encodeURIComponent($)}`:`/listings/collection/${B}/all?limit=${Math.min(N,100)}`,R=await Wt(te,se,ae);if((Y=R==null?void 0:R.listings)!=null&&Y.length){let ne=R.listings;Array.isArray(k)&&k.length&&(ne=ne.filter(Q=>{const s=Q.order_source||Q.order_source_name||Q.order_provider||"";return s?k.some(z=>s.toLowerCase().includes(z)):!0})),H.push(...ne)}$=(R==null?void 0:R.next)||null,J+=1}while($&&J<a);if(W&&W(.9,"Processing price clusters..."),j&&j>0){const te=new Map,R=Q=>{var z;const s=(z=Q.price)==null?void 0:z.current;return s?`${s.value}-${s.currency??""}-${s.decimals??""}`:null};for(const Q of H){const s=R(Q);s&&te.set(s,(te.get(s)||0)+1)}const ne=new Set([...te.entries()].filter(([,Q])=>Q>=j).map(([Q])=>Q));if(ne.size)return W&&W(.95,`Filtering out ${ne.size} price clusters...`),H.filter(Q=>!ne.has(R(Q)))}return W&&W(1,`Found ${H.length} listings`),H}async function mn(B,se,{pageSize:ae=1e3,maxPages:N=1/0,chain:a="ethereum",sort:k="desc",progressCallback:j=null}={}){const W="https://api.etherscan.io/api";let H=1;const $="0x0000000000000000000000000000000000000000",J=new Map,Y=new Set;let te=0,R=0;const ne=3,Q=Math.min(N===1/0?50:N,50);for(;H<=N;){if(j){const q=Math.min((H-1)/Q,.9),de=`Processing transfer history - page ${H}...`;j(q,de)}const z=`${W}?module=account&action=tokennfttx&contractaddress=${B}&page=${H}&offset=${ae}&sort=${k}&apikey=${se}`,re=await fetch(z);if(!re.ok)throw new Error(`Etherscan error ${re.status}`);const G=await re.json();if(G.status!=="1"||!Array.isArray(G.result))break;const X=G.result;if(X.length===0)break;let $e=0;for(const q of X){const de=parseInt(q.tokenID,10);if(Number.isFinite(de)){if(k==="desc"){if(Y.has(de))continue;Y.add(de);const fe=q.to.toLowerCase();if(fe!==$){let ce=J.get(fe);ce||(ce=new Set,J.set(fe,ce)),ce.add(de)}$e++}else{const fe=q.from.toLowerCase(),ce=q.to.toLowerCase();if(fe!==$){const _=J.get(fe);_&&(_.delete(de),_.size===0&&J.delete(fe))}if(ce!==$){let _=J.get(ce);_||(_=new Set,J.set(ce,_)),_.add(de)}}te+=1}}if(k==="desc"&&($e===0?R+=1:R=0,R>=ne)||X.length<ae)break;H+=1}j&&j(.95,"Organizing collector data...");const s=[...J.entries()].map(([z,re])=>({address:z,tokens:[...re],count:re.size})).sort((z,re)=>re.count-z.count);return j&&j(1,`Found ${s.length} collectors from ${te.toLocaleString()} transfers`),{collectors:s,totalScanned:te}}(function(){const N=dn("8I4QUDIYPJ","0b78c3d3ea56c86c7d766052bad49abe","songs"),a="533037544c3044d9be47567bbb711433",k="0x19b703f65aa7e1e775bd06c2aa0d0d08c80f1c45",j="EM1PCRCG3FZA7GN4Y4JT8VSR3MTP7X1WNB",W=["opensea","blur"];let H=null,$=null;console.log("OpenSea ENV Vars:",{key:"Loaded",contract:"Loaded"});let J=null,Y=null;function te(i,m="Loading..."){var p;(p=i.querySelector(".progress-container"))==null||p.remove();const c=document.createElement("div");c.className="progress-container",c.innerHTML=`
            <div class="progress-header">
                <span class="progress-title">${m}</span>
                <span class="progress-percentage">0%</span>
            </div>
            <div class="progress-bar-bg">
                <div class="progress-bar-fill"></div>
            </div>
            <div class="progress-status">Starting...</div>
        `;const d=document.createElement("style");return d.textContent=`
            .progress-container {
                margin: 16px 0;
                padding: 16px;
                background: rgba(255,255,255,0.05);
                border-radius: 8px;
                border: 1px solid rgba(255,255,255,0.1);
            }
            .progress-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 8px;
            }
            .progress-title {
                font-weight: 600;
                color: #fff;
            }
            .progress-percentage {
                font-size: 12px;
                color: #aaa;
                font-family: monospace;
            }
            .progress-bar-bg {
                height: 6px;
                background: rgba(255,255,255,0.1);
                border-radius: 3px;
                overflow: hidden;
                margin-bottom: 8px;
            }
            .progress-bar-fill {
                height: 100%;
                background: linear-gradient(90deg, #4CAF50, #81C784);
                border-radius: 3px;
                width: 0%;
                transition: width 0.3s ease;
            }
            .progress-status {
                font-size: 12px;
                color: #bbb;
                font-style: italic;
            }
        `,document.head.querySelector("#progress-bar-styles")||(d.id="progress-bar-styles",document.head.appendChild(d)),i.appendChild(c),c}function R(i,m,c=""){if(!i)return;const d=Math.round(m*100),p=i.querySelector(".progress-bar-fill"),x=i.querySelector(".progress-percentage"),E=i.querySelector(".progress-status");p&&(p.style.width=`${d}%`),x&&(x.textContent=`${d}%`),E&&c&&(E.textContent=c)}function ne(i){var m;(m=i.querySelector(".progress-container"))==null||m.remove()}async function Q(i=null){return J||Y||(Y=(async()=>{var x,E,I,h,l,u,g,v;H||(i&&i(.05,"Getting collection information..."),H=await Kt(k,a)),i&&i(.1,"Starting to fetch listings...");const c=await pn(H,a,"ethereum",100,65,W,0,(O,F)=>{const T=.1+O*.7;i&&i(T,F)});i&&i(.85,"Processing and deduplicating listings...");const d=new Map;for(const O of c){const F=(h=(I=(E=(x=O==null?void 0:O.protocol_data)==null?void 0:x.parameters)==null?void 0:E.offer)==null?void 0:I[0])==null?void 0:h.identifierOrCriteria;if(F==null)continue;const T=F.toString(),A=(u=(l=O==null?void 0:O.price)==null?void 0:l.current)!=null&&u.value?BigInt(O.price.current.value):BigInt(0),le=d.get(T);if(!le)d.set(T,O);else{const he=(v=(g=le.price)==null?void 0:g.current)!=null&&v.value?BigInt(le.price.current.value):BigInt(0);A<he&&d.set(T,O)}}i&&i(.95,"Finalizing results...");const p=[...d.values()];return J=p,i&&i(1,"Complete!"),p})().catch(m=>{throw Y=null,m}),Y)}const s=OpenSeadragon({id:"viewer",prefixUrl:"https://cdnjs.cloudflare.com/ajax/libs/openseadragon/4.1.0/images/",showNavigator:!1,showNavigationControl:!1,showHomeControl:!1,showZoomControl:!1,showFullPageControl:!1,constrainDuringPan:!0,visibilityRatio:1,minZoomImageRatio:.8,defaultZoomLevel:.8,springStiffness:5,animationTime:.7,homeFitBounds:!0,tileSources:{height:20520,width:36960,tileSize:256,minLevel:0,maxLevel:7,getTileUrl:function(i,m,c){return`https://songadaygallery.blob.core.windows.net/dzi/level_${i}/tiles/${m}_${c}.jpg`}}}),z=77,re=76,G=36960/z,X=20520/re,$e=document.createElement("div");$e.id="gif-container",s.canvas.appendChild($e);const q=document.createElement("div");q.className="highlight-box",s.element.appendChild(q);let de=null,fe=new Map;const ce=new Map,_=new Map;let C=null;function nt(){ce.forEach(i=>i.remove()),ce.clear()}function bt(i){const m=(i-1)%z,c=Math.floor((i-1)/z),d=new OpenSeadragon.Rect(m*G,c*X,G,X),p=document.createElement("div");p.style.position="absolute",p.style.pointerEvents="none",p.style.zIndex="1001",p.style.border="2px solid #1f7a3d";const x=s.viewport.imageToViewportRectangle(d),E=s.viewport.viewportToViewerElementRectangle(x);return p.style.left=E.x+"px",p.style.top=E.y+"px",p.style.width=E.width+"px",p.style.height=E.height+"px",s.element.appendChild(p),s.addHandler("animation",()=>{if(!p.parentNode)return;const I=s.viewport.imageToViewportRectangle(d),h=s.viewport.viewportToViewerElementRectangle(I);p.style.left=h.x+"px",p.style.top=h.y+"px",p.style.width=h.width+"px",p.style.height=h.height+"px"}),p}function rt(i){nt(),Array.from(new Set(i.map(c=>parseInt(c,10)).filter(c=>Number.isFinite(c)&&c>=1&&c<=5852))).forEach(c=>{const d=bt(c);ce.set(c,d)})}function ot(i){if(!i)return null;const m=s.viewport.pointFromPixel(i),c=s.viewport.viewportToImageCoordinates(m),d=Math.floor(c.x/G),p=Math.floor(c.y/X);if(d>=0&&d<z&&p>=0&&p<re){const x=p*z+d+1;if(x<=5852)return{id:x,rect:new OpenSeadragon.Rect(d*G,p*X,G,X)}}return null}function ut(){const i=s.viewport.getBounds(),m=s.viewport.viewportToImageRectangle(i),c=Math.max(0,Math.floor(m.x/G)),d=Math.max(0,Math.floor(m.y/X)),p=Math.min(z-1,Math.ceil((m.x+m.width)/G)),x=Math.min(re-1,Math.ceil((m.y+m.height)/X)),E=[];for(let I=d;I<=x;I++)for(let h=c;h<=p;h++){const l=I*z+h+1;l<=5852&&E.push({id:l,rect:new OpenSeadragon.Rect(h*G,I*X,G,X)})}return E}function wt(){const i=s.viewport.getZoom(),m=s.viewport.getMaxZoom();if(i>m*.2){const p=ut(),x=new Set;p.forEach(E=>{if(x.add(E.id),!fe.has(E.id)){const u=document.createElement("div");u.className="gif-overlay";const g=document.createElement("img");g.src=`https://songadaygallery.blob.core.windows.net/dzi/${E.id}.gif`,u.appendChild(g),$e.appendChild(u),fe.set(E.id,u)}const I=fe.get(E.id),h=s.viewport.imageToViewportRectangle(E.rect),l=s.viewport.viewportToViewerElementRectangle(h);I.style.left=l.x+"px",I.style.top=l.y+"px",I.style.width=l.width+"px",I.style.height=l.height+"px",I.style.display="block"});for(const[E,I]of fe)x.has(E)||(I.remove(),fe.delete(E))}else fe.forEach(p=>p.remove()),fe.clear()}function _e(i){const m=ot(i);if(m){de=m.id;const c=s.viewport.imageToViewportRectangle(m.rect),d=s.viewport.viewportToViewerElementRectangle(c);q.style.left=d.x+"px",q.style.top=d.y+"px",q.style.width=d.width+"px",q.style.height=d.height+"px",q.style.display="block"}else de=null,q.style.display="none"}s.addHandler("animation",function(){wt(),de&&s.lastMousePosition&&_e(s.lastMousePosition),ze()}),s.addHandler("update-viewport",()=>{wt(),de&&s.lastMousePosition&&_e(s.lastMousePosition),ze()}),new OpenSeadragon.MouseTracker({element:s.canvas,moveHandler:i=>{i.buttons||_e(i.position)},overHandler:i=>{i.buttons||_e(i.position)},outHandler:()=>{de=null,q.style.display="none"},stopHandler:()=>{de&&s.lastMousePosition&&_e(s.lastMousePosition)}}),fetch("data/coordinate_maps.json").then(i=>i.json()).then(i=>{window.songCoordinates=i}).catch(i=>console.error("Error loading coordinates:",i));const Oe=document.getElementById("songModal"),xt=Oe.querySelector(".close-button"),Pe=document.getElementById("left-sidebar"),Qe=Pe.querySelector(".left-sidebar-title"),V=Pe.querySelector(".left-sidebar-content"),St=document.getElementById("close-left-sidebar-btn"),Me=document.getElementById("activity-btn"),Be=document.getElementById("collectors-btn"),Fe=document.getElementById("for-sale-btn"),it=document.getElementById("home-view-btn"),Et=document.getElementById("search-input"),Se=document.getElementById("for-sale-count");xt.addEventListener("click",()=>Oe.style.display="none"),Oe.addEventListener("click",i=>{i.target===Oe&&(Oe.style.display="none")}),it&&it.addEventListener("click",()=>s.viewport.goHome()),Et&&an(Et,N,i=>He(i),i=>at(i));function $t(i){return i?i.includes("youtu.be")?i.split("youtu.be/")[1]:new URL(i).searchParams.get("v"):null}async function He(i){try{const m=await N.getObject(i.toString());if(!m){console.error("Song not found in Algolia:",i);return}const c=Oe.querySelector(".modal-content");c.querySelector(".song-title").textContent=m.name,c.querySelector(".song-number").textContent=`Song #${m.token_id}`,c.querySelectorAll(".os-link").forEach(h=>h.remove());const d=document.createElement("a");d.href=`https://opensea.io/assets/ethereum/${k}/${m.token_id}`,d.textContent="View on OpenSea",d.target="_blank",d.style.display="inline-block",d.style.margin="8px 0",d.style.fontWeight="600",d.className="external-link os-link";const p=c.querySelector(".song-number");p==null||p.after(d);const x=c.querySelector(".video-container");if(x.innerHTML="",m.youtube_url){const h=$t(m.youtube_url);if(h){const l=document.createElement("iframe");l.src=`https://www.youtube.com/embed/${h}`,l.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",l.allowFullscreen=!0,x.appendChild(l)}}const E=c.querySelector(".attributes-grid");E.innerHTML="",m.attributes&&Array.isArray(m.attributes)&&m.attributes.forEach(h=>{if(h.trait_type!=="Song A Day"){const l=document.createElement("div");l.className="attribute-item",l.innerHTML=`<div class="attribute-label">${h.trait_type}</div><div class="attribute-value">${h.value}</div>`,E.appendChild(l)}});const I=c.querySelector(".external-links");if(I.innerHTML="",m.external_url){const h=document.createElement("a");h.href=m.external_url,h.className="external-link",h.textContent="View on Song A Day",h.target="_blank",I.appendChild(h)}Oe.style.display="block"}catch(m){console.error("Error fetching song details from Algolia:",m)}}async function at(i){var m,c;if(i)try{const{hits:d}=await N.search(i,{hitsPerPage:50}),p=document.getElementById("left-sidebar"),x=p.querySelector(".left-sidebar-title"),E=p.querySelector(".left-sidebar-content");if(!p||!x||!E){console.error("Left sidebar elements not found for search results!");return}if(E.innerHTML="",x.textContent=`Results for "${i}"`,d.length===0){const I=document.createElement("p");I.textContent="No results found.",E.appendChild(I)}else{const I=document.createElement("ul");I.className="search-results-list",I.style.listStyleType="none",I.style.paddingLeft="0",d.forEach(h=>{const l=document.createElement("li");l.style.padding="8px 0",l.style.borderBottom="1px solid rgba(255,255,255,0.1)",l.style.cursor="pointer";const u=h.name||`Song #${h.token_id}`,g=h.objectID;l.textContent=u,l.addEventListener("click",()=>{p.classList.remove("visible"),He(parseInt(g,10))}),g&&(l.addEventListener("mouseenter",()=>{const v=parseInt(g,10);if(!Number.isFinite(v)||v<1||v>5852)return;const O=(v-1)%z,F=Math.floor((v-1)/z),T=new OpenSeadragon.Rect(O*G,F*X,G,X),A=1.5,le=T.width*(A-1)/2,he=T.height*(A-1)/2,pe=new OpenSeadragon.Rect(T.x-le,T.y-he,T.width*A,T.height*A),oe=s.viewport.imageToViewportRectangle(pe);s.viewport.fitBounds(oe,!1);const ue=s.viewport.viewportToViewerElementRectangle(s.viewport.imageToViewportRectangle(T));q.style.left=ue.x+"px",q.style.top=ue.y+"px",q.style.width=ue.width+"px",q.style.height=ue.height+"px",q.style.display="block"}),l.addEventListener("mouseleave",()=>{q.style.display="none"})),l.addEventListener("mouseenter",()=>{l.style.background="rgba(255,255,255,0.1)"}),l.addEventListener("mouseleave",()=>{l.style.background=""}),I.appendChild(l)}),E.appendChild(I)}p.classList.add("visible")}catch(d){console.error("Error performing search and displaying in sidebar",d);const p=(m=document.getElementById("left-sidebar"))==null?void 0:m.querySelector(".left-sidebar-content");p&&(p.innerHTML="<p>Error loading search results.</p>",(c=document.getElementById("left-sidebar"))==null||c.classList.add("visible"))}}s.addHandler("canvas-click",function(i){if(!i.quick)return;const m=ot(i.position);m&&He(m.id)});let dt=new Map,Ee=new Map,ft=new Map;function _t(i){const m=(i-1)%z,c=Math.floor((i-1)/z),d=new OpenSeadragon.Rect(m*G,c*X,G,X),p=document.createElement("div");p.style.position="absolute",p.style.background="rgba(0,0,0,0.5)",p.style.pointerEvents="none",p.style.zIndex="1001";const x=s.viewport.imageToViewportRectangle(d),E=s.viewport.viewportToViewerElementRectangle(x);return p.style.left=E.x+"px",p.style.top=E.y+"px",p.style.width=E.width+"px",p.style.height=E.height+"px",s.canvas.appendChild(p),s.addHandler("animation",()=>{if(!p.parentNode)return;const I=s.viewport.imageToViewportRectangle(d),h=s.viewport.viewportToViewerElementRectangle(I);p.style.left=h.x+"px",p.style.top=h.y+"px",p.style.width=h.width+"px",p.style.height=h.height+"px"}),p}function It(){const i=[];return Ee.forEach((m,c)=>{const d=[];m.forEach(p=>{d.push(`${c}:${p}`)}),d.length>0&&i.push(d)}),i}async function Ot(){dt.forEach(m=>m.remove()),dt.clear();const i=It();if(i.length===0){jt();return}try{const{hits:m}=await N.search("",{facetFilters:i,attributesToRetrieve:["objectID"],hitsPerPage:5852}),c=m.map(x=>parseInt(x.objectID,10)).filter(x=>Number.isFinite(x)),d=new Set(c);ut().forEach(x=>{if(!d.has(x.id)){const E=_t(x.id);dt.set(x.id,E)}}),zt(c)}catch(m){console.error("Error applying filters with Algolia:",m)}}async function Te(){const i=document.querySelector("#right-sidebar .filter-content");i.innerHTML="";const m=["Topic","Genre","Mood","Location","Instrument","Style","Noun","Proper Noun"],c=document.createElement("button");c.textContent="Clear Filters",c.style.margin="0 0 12px 16px",c.addEventListener("click",()=>{i.querySelectorAll(".filter-checkbox").forEach(d=>d.checked=!1),Ee.clear(),s.viewport.goHome(),Ot(),Te()}),i.appendChild(c);try{const{facets:d}=await N.search("",{facets:m,hitsPerPage:0,maxValuesPerFacet:1e3,facetFilters:It()});if(!d){console.error("No facets received from Algolia.");return}m.forEach(p=>{const x=d[p];if(!x||Object.keys(x).length===0)return;const E=document.createElement("div");E.className="filter-section";const I=document.createElement("div");I.className="filter-section-header",I.innerHTML=`<span class="filter-section-title">${p}</span><span class="filter-count">${Object.keys(x).length}</span>`;const h=document.createElement("div");h.className="filter-options",h.style.display="none",Object.entries(x).sort(([u,g],[v,O])=>O===g?u.localeCompare(v):O-g).forEach(([u,g])=>{const v=document.createElement("div");v.className="filter-option";const O=`filter-${p}-${u}`.replace(/\s+/g,"-").toLowerCase(),F=Ee.has(p)&&Ee.get(p).has(u);v.innerHTML=`
                        <input type="checkbox" id="${O}" class="filter-checkbox" data-trait="${p}" data-value="${u}" ${F?"checked":""}>
                        <label for="${O}" class="filter-label"><span class="filter-value">${u}</span><span class="filter-value-count">${g}</span></label>`,v.querySelector("input").addEventListener("change",T=>{const A=T.target.dataset.trait,le=T.target.dataset.value;Ee.has(A)||Ee.set(A,new Set),T.target.checked?Ee.get(A).add(le):(Ee.get(A).delete(le),Ee.get(A).size===0&&Ee.delete(A)),s.viewport.goHome(),Ot(),Te(),T.stopPropagation()}),h.appendChild(v)}),E.appendChild(I),E.appendChild(h),i.appendChild(E),I.addEventListener("click",()=>{const u=h.style.display==="none";document.querySelectorAll(".filter-options").forEach(g=>g.style.display="none"),u&&(h.style.display="block")})})}catch(d){console.error("Error initializing filter sections from Algolia:",d)}}function pt(){const i=document.getElementById("right-sidebar");i.classList.contains("visible")?i.classList.remove("visible"):(i.classList.add("visible"),i.hasAttribute("data-initialized")||(Te(),i.setAttribute("data-initialized","true")))}const Pt=document.getElementById("explore-btn");Pt&&Pt.addEventListener("click",pt);const kt=document.getElementById("close-filter-btn");kt&&kt.addEventListener("click",pt);const Tt=document.createElement("style");Tt.textContent=`
        .filter-option{display:flex;align-items:center;justify-content:space-between;padding:8px 16px;}
        .filter-option:hover{background:rgba(0,0,0,0.05);}
        .filter-label{flex:1;display:flex;justify-content:space-between;align-items:center;margin-left:12px;cursor:pointer;}
        .filter-value{color:black;}
        .filter-value-count{color:#666;font-size:14px;}
        .filter-section-header{padding:12px 16px;}
        .filter-options{background:#f5f5f5;margin:0 -20px;}
    `,document.head.appendChild(Tt),s.addHandler("open",()=>{s.viewport.goHome(!0);const i=s.viewport.getHomeBounds();typeof s.viewport.fitBounds=="function"&&s.viewport.fitBounds(i,!0)});async function Mt(){if(!H||!Se){Se&&(Se.textContent="N/A");return}try{const i=await Q();Se.textContent=i.length.toString()}catch(i){console.error("Failed to update for-sale count:",i),Se&&(Se.textContent="N/A")}}async function Rt(){console.log("initOpenSea called. API Key:","Present","Contract:","Present");try{const i=await Kt(k,a);i?(H=i,console.log("Fetched OpenSea collection slug:",H),Mt().catch(m=>console.error("updateForSaleCount error",m))):(console.error("Failed to fetch OpenSea collection slug. Slug was null or empty."),Se&&(Se.textContent="N/A"),Me&&(Me.disabled=!0),Be&&(Be.disabled=!0),Fe&&(Fe.disabled=!0))}catch(i){console.error("Error initializing OpenSea:",i),Se&&(Se.textContent="N/A"),Me&&(Me.disabled=!0),Be&&(Be.disabled=!0),Fe&&(Fe.disabled=!0)}}async function Re(i,m){if(console.log(`openLeftSidebar called with contentType: ${i}, title: ${m}`),!Pe||!Qe||!V){console.error("Left sidebar elements not found!");return}if(!H&&(i==="forSale"||i==="activity"||i==="collectors")&&(Qe.textContent=m,V.innerHTML="<p>Initializing OpenSea data...</p>",console.log("Attempting to show left sidebar for initializing OpenSea"),Pe.classList.add("visible"),await Rt(),!H)){Qe.textContent="Error",V.innerHTML="<p>Could not load collection data. Please check console for errors.</p>",console.log("Attempting to show left sidebar for slug fetch error"),Pe.classList.add("visible");return}Qe.textContent=m,V.innerHTML="",Pe.classList.contains("visible")||(console.log("Attempting to show left sidebar for content loading"),Pe.classList.add("visible"));try{let c,d;if(!H)throw new Error("Collection slug not available.");switch(i!=="sales"&&ht(),i){case"forSale":d=te(V,"Loading items for sale..."),c=await Q((l,u)=>{R(d,l,u)}),ne(V),await Ct(c,V),s.viewport.goHome();const x=c.map(l=>{var u,g,v,O;return(O=(v=(g=(u=l==null?void 0:l.protocol_data)==null?void 0:u.parameters)==null?void 0:g.offer)==null?void 0:v[0])==null?void 0:O.identifierOrCriteria}).map(l=>parseInt(l,10)).filter(l=>Number.isFinite(l));C=new Set(x),rt(x),ze();break;case"activity":if(!V.querySelector(".activity-tabs")){const l=document.createElement("div");l.className="activity-tabs",l.style.display="flex",l.style.gap="12px",l.style.marginBottom="12px",[{label:"Listings",type:"listing"},{label:"All",type:null},{label:"Sales",type:"sale"},{label:"Offers",type:"offer"}].forEach(g=>{const v=document.createElement("button");v.textContent=g.label,v.className="activity-tab-btn",v.dataset.eventType=g.type??"",v.style.padding="6px 10px",v.style.border="none",v.style.borderRadius="4px",v.style.cursor="pointer",v.style.background="rgba(255,255,255,0.1)",v.style.color="#fff",v.addEventListener("click",async()=>{var O;Array.from(l.children).forEach(F=>F.classList.remove("active")),v.classList.add("active"),(O=V.querySelector(".activity-list"))==null||O.remove(),await E(g.type)}),l.appendChild(v)}),l.firstChild.classList.add("active"),V.appendChild(l)}const E=async l=>{var g,v,O;(g=V.querySelector(".activity-loading"))==null||g.remove();let u;if(l==="listing"){u=te(V,"Loading current listings...");const F=(T,A)=>{R(u,T,A)};try{const T=await Q(F);ne(V),(v=V.querySelector(".activity-list"))==null||v.remove(),(O=V.querySelector(".for-sale-list"))==null||O.remove();const A=document.createElement("div");A.className="for-sale-list",V.appendChild(A),await Ct(T,A)}catch(T){console.error("Activity load error",T),ne(V);const A=document.createElement("p");A.textContent="Failed to load listings.",V.appendChild(A)}}else{u=te(V,`Loading ${l||"all"} activity...`),R(u,.5,"Fetching activity data...");try{const T=(await Yt(H,a,"ethereum",l,50)).filter(A=>A.order_type!=="collection_offer");ne(V),At(T,V)}catch(F){console.error("Activity load error",F),ne(V);const T=document.createElement("p");T.textContent="Failed to load activity.",V.appendChild(T)}}};await E("listing");return;case"collectors":d=te(V,"Loading collector data..."),c=await mn(k,j,{pageSize:1e3,sort:"desc",progressCallback:(l,u)=>{R(d,l,u)}}),ne(V),$=c,Lt(c,V);break;case"sales":d=te(V,"Loading recent sales..."),R(d,.5,"Fetching sales data..."),c=await Yt(H,a,"ethereum","sale",50),ne(V),At(c,V),s.viewport.goHome();const h=c.map(Ft).map(l=>parseInt(l,10)).filter(l=>Number.isFinite(l));C=new Set(h),rt(h),ze();break;default:V.innerHTML="<p>Selected section not yet implemented.</p>"}}catch(c){console.error(`Error fetching OpenSea ${i} data:`,c),ne(V),Qe.textContent="Error",V.innerHTML="<p>Failed to load data from OpenSea. Please try again later.</p>"}}Me&&Me.addEventListener("click",()=>{console.log("Sales button clicked"),Re("sales","Recent Sales")}),Be&&Be.addEventListener("click",()=>{console.log("Collectors button clicked"),Re("collectors","Top Collectors")}),Fe&&Fe.addEventListener("click",()=>{console.log("For Sale button clicked"),Re("forSale","Items For Sale")}),St&&St.addEventListener("click",()=>{console.log("Close left sidebar button clicked"),Pe.classList.remove("visible"),ht()});function mt(i,m=18,c=4){try{if(!i)return"0";const d=BigInt(i.toString()),p=BigInt(10)**BigInt(m),x=d/p;let I=(d%p).toString().padStart(m,"0");return I=I.slice(0,c),I=I.replace(/0+$/,""),I.length>0?`${x}.${I}`:x.toString()}catch{return"0"}}async function Ct(i,m){if(m.innerHTML="",!i||i.length===0){m.innerHTML="<p>No items currently for sale.</p>";return}const c=new Map,d=[];i.forEach(h=>{var v,O,F,T,A,le,he,pe;const l=(T=(F=(O=(v=h==null?void 0:h.protocol_data)==null?void 0:v.parameters)==null?void 0:O.offer)==null?void 0:F[0])==null?void 0:T.identifierOrCriteria;if(l==null){d.push(h);return}const u=l.toString(),g=c.get(u);if(!g)c.set(u,h);else{const oe=(le=(A=h.price)==null?void 0:A.current)!=null&&le.value?BigInt(h.price.current.value):BigInt(0),ue=(pe=(he=g.price)==null?void 0:he.current)!=null&&pe.value?BigInt(g.price.current.value):BigInt(0);if(oe<ue)c.set(u,h);else if(oe===ue){const ke=be=>Date.parse(be.created_date||be.order_created_date||be.listing_date||be.updated_date||0);ke(h)>ke(g)&&c.set(u,h)}}});let p=[...c.values(),...d];const x=document.createElement("ul");x.style.listStyleType="none",x.style.paddingLeft="0",p.sort((h,l)=>{var v,O,F,T;const u=(O=(v=h.price)==null?void 0:v.current)!=null&&O.value?BigInt(h.price.current.value):BigInt(0),g=(T=(F=l.price)==null?void 0:F.current)!=null&&T.value?BigInt(l.price.current.value):BigInt(0);return u>g?1:u<g?-1:0});const E=p.map(h=>{var u,g,v,O;const l=(O=(v=(g=(u=h.protocol_data)==null?void 0:u.parameters)==null?void 0:g.offer)==null?void 0:v[0])==null?void 0:O.identifierOrCriteria;return l?l.toString():null}).filter(Boolean),I={};if(E.length)try{const{results:h}=await N.getObjects(E);h.forEach(l=>{l&&(I[l.objectID]=l.name)})}catch(h){console.error("Error fetching titles from Algolia:",h)}p.forEach(h=>{var pe,oe,ue,ke,be,Ce,Ae,Le,Ie,Ve,Xe,Ue,De,je,Ze;const l=document.createElement("li");l.style.padding="8px 0",l.style.borderBottom="1px solid #444";let u=null;(ue=(oe=(pe=h.protocol_data)==null?void 0:pe.parameters)==null?void 0:oe.offer)!=null&&ue.length&&(u=h.protocol_data.parameters.offer[0].identifierOrCriteria);const g=u!=null?u.toString():null,v=g&&I[g]||((ke=h.nft)==null?void 0:ke.name)||((be=h.asset)==null?void 0:be.name)||(u?`Song #${u}`:"Unknown Song"),O=(Ae=(Ce=h.price)==null?void 0:Ce.current)==null?void 0:Ae.value,F=((Ie=(Le=h.price)==null?void 0:Le.current)==null?void 0:Ie.decimals)||18,T=O?mt(O,F):"N/A",A=((Xe=(Ve=h.price)==null?void 0:Ve.current)==null?void 0:Xe.currency)||"ETH",he=((Ue=h.nft)==null?void 0:Ue.image_url)||((De=h.nft)==null?void 0:De.display_image_url)||((je=h.asset)==null?void 0:je.image_url)||((Ze=h.asset)==null?void 0:Ze.display_image_url)||""||(u?`https://songadaygallery.blob.core.windows.net/dzi/${u}.gif`:"");l.innerHTML=`<div style="display:flex;gap:10px;align-items:center;">
                    <img src="${he}" style="width:48px;height:48px;object-fit:cover;border-radius:4px;background:#222;" />
                    <div style="flex:1;">
                        <div style="font-weight:600;">${v}</div>
                        <div style="font-size:12px;color:#aaa;">Song #${u??"â"}</div>
                    </div>
                    <div style="text-align:right;white-space:nowrap;">${T} ${A}</div>
                 </div>`,x.appendChild(l),u&&(l.addEventListener("mouseenter",()=>{const we=parseInt(g,10);if(!Number.isFinite(we)||we<1||we>5852)return;const Ge=(we-1)%z,st=Math.floor((we-1)/z),ge=new OpenSeadragon.Rect(Ge*G,st*X,G,X),qe=1.5,We=ge.width*(qe-1)/2,et=ge.height*(qe-1)/2,K=new OpenSeadragon.Rect(ge.x-We,ge.y-et,ge.width*qe,ge.height*qe),Je=s.viewport.imageToViewportRectangle(K);s.viewport.fitBounds(Je,!1);const xe=s.viewport.viewportToViewerElementRectangle(s.viewport.imageToViewportRectangle(ge));q.style.left=xe.x+"px",q.style.top=xe.y+"px",q.style.width=xe.width+"px",q.style.height=xe.height+"px",q.style.display="block"}),l.addEventListener("mouseleave",()=>{q.style.display="none"}),l.addEventListener("click",()=>{const we=parseInt(g,10);Number.isFinite(we)&&He(we)})),l.addEventListener("mouseenter",()=>{l.style.background="rgba(255,255,255,0.05)"}),l.addEventListener("mouseleave",()=>{l.style.background=""})}),m.appendChild(x)}function At(i,m){var l;const c=u=>{var g,v,O,F,T,A;return((g=u==null?void 0:u.nft)==null?void 0:g.identifier)??((v=u==null?void 0:u.asset)==null?void 0:v.token_id)??((A=(T=(F=(O=u==null?void 0:u.protocol_data)==null?void 0:O.parameters)==null?void 0:F.offer)==null?void 0:T[0])==null?void 0:A.identifierOrCriteria)??null};if((l=m.querySelector(".activity-list"))==null||l.remove(),!i||i.length===0){const u=document.createElement("p");u.textContent="No recent activity.",m.appendChild(u);return}const d=new Set;i.forEach(u=>{const g=c(u);g!=null&&d.add(g.toString())});const p={},x={},E=new Set;i.forEach(u=>{var v,O;const g=c(u);if(g==null){const F=(((v=u==null?void 0:u.nft)==null?void 0:v.name)||((O=u==null?void 0:u.asset)==null?void 0:O.name)||"").trim();F&&E.add(F.toLowerCase())}});const I=[];if(d.size&&I.push(N.getObjects(Array.from(d)).then(({results:u})=>{u.forEach(g=>{g&&(p[g.objectID]=g.name)})}).catch(u=>console.error("Algolia title fetch error",u))),E.size){const u=Array.from(E).map(g=>N.search(g,{hitsPerPage:1,restrictSearchableAttributes:["name"],attributesToRetrieve:["objectID"]}).then(v=>{const O=v.hits&&v.hits[0];O&&(x[g]=O.objectID,p[O.objectID]=O.name||g)}).catch(v=>console.error("Algolia lookup error",v)));I.push(Promise.all(u))}Promise.all(I).then(()=>{if(i.length&&i[0].event_type==="listing"){const u=new Set;i=i.filter(g=>{const v=c(g);return v==null?!0:u.has(v)?!1:(u.add(v),!0)})}h()}).catch(u=>{console.error("Algolia async error",u),h()});function h(){const u=document.createElement("ul");u.className="activity-list",u.style.listStyleType="none",u.style.paddingLeft="0",i.forEach(g=>{var Ze,we,Ge,st,ge,qe,We,et;const v=document.createElement("li");v.className="activity-row",v.style.display="flex",v.style.alignItems="center",v.style.gap="12px",v.style.padding="10px 0",v.style.borderBottom="1px solid #444";const O=document.createElement("img");O.className="activity-thumb",O.style.width="48px",O.style.height="48px",O.style.objectFit="cover",O.style.borderRadius="4px";const F=((Ze=g.nft)==null?void 0:Ze.display_image_url)||((we=g.nft)==null?void 0:we.image_url)||((Ge=g.asset)==null?void 0:Ge.display_image_url)||((st=g.asset)==null?void 0:st.image_url)||"";F?O.src=F:O.style.background="#222",v.appendChild(O);let T=c(g);if(T==null){const K=(((ge=g.nft)==null?void 0:ge.name)||((qe=g.asset)==null?void 0:qe.name)||"").trim().toLowerCase();K&&x[K]&&(T=x[K])}const A=T!=null?T.toString():"",le=A&&p[A]||((We=g.nft)==null?void 0:We.name)||((et=g.asset)==null?void 0:et.name)||`Song #${A}`,he=g.event_type.replace(/_/g," "),pe=document.createElement("div");pe.style.flex="1";const oe=document.createElement("span");oe.textContent=he.charAt(0).toUpperCase()+he.slice(1),oe.className=`activity-badge badge-${g.event_type}`,oe.style.padding="2px 6px",oe.style.borderRadius="4px",oe.style.fontSize="11px",oe.style.fontWeight="700",oe.style.textTransform="capitalize",oe.style.marginRight="6px";const ue={sale:"#1f7a3d",listing:"#7a3d1f",offer:"#3d5d7a"};oe.style.background=ue[g.event_type]||"#555",oe.style.color="#fff";const ke=document.createElement("span");ke.textContent=le;const be=document.createElement("div");be.appendChild(oe),be.appendChild(ke);const Ce=K=>K?`${K.slice(0,4)}â¦${K.slice(-4)}`:"";let Ae="";g.buyer&&g.seller?Ae=`${Ce(g.seller)} â ${Ce(g.buyer)}`:g.maker&&g.taker!==void 0&&(Ae=`${Ce(g.maker)} â ${Ce(g.taker||"")}`);const Le=document.createElement("div");Le.style.fontSize="11px",Le.style.color="#aaa",Le.textContent=Ae,pe.appendChild(be),Ae&&pe.appendChild(Le),v.appendChild(pe);const Ie=document.createElement("div");Ie.style.textAlign="right",Ie.style.fontSize="12px";let Ve="";g.payment&&g.payment.quantity?Ve=`${mt(g.payment.quantity,g.payment.decimals||18,3)} ${g.payment.symbol||"ETH"}`:g.total_price&&g.payment_token&&(Ve=`${mt(g.total_price,g.payment_token.decimals||18,3)} ${g.payment_token.symbol}`);const Xe=document.createElement("div");Xe.textContent=Ve;const Ue=g.event_timestamp||g.closing_date||null;let De="";if(Ue){const K=Math.floor(Date.now()/1e3)-Ue,Je=[{l:"y",s:31536e3},{l:"mo",s:2592e3},{l:"d",s:86400},{l:"h",s:3600},{l:"m",s:60}];for(const xe of Je)if(K>=xe.s){De=`${Math.floor(K/xe.s)}${xe.l}`;break}De||(De=`${K}s`)}const je=document.createElement("div");je.style.color="#aaa",je.style.fontSize="10px",je.textContent=De,Ie.appendChild(Xe),Ie.appendChild(je),v.appendChild(Ie),u.appendChild(v),T&&(v.addEventListener("mouseenter",()=>{const K=parseInt(A,10);if(!Number.isFinite(K)||K<1||K>5852)return;const Je=(K-1)%z,xe=Math.floor((K-1)/z),Ne=new OpenSeadragon.Rect(Je*G,xe*X,G,X),ee=1.5,Ke=Ne.width*(ee-1)/2,gt=Ne.height*(ee-1)/2,Vt=new OpenSeadragon.Rect(Ne.x-Ke,Ne.y-gt,Ne.width*ee,Ne.height*ee),Ut=s.viewport.imageToViewportRectangle(Vt);s.viewport.fitBounds(Ut,!1);const ct=s.viewport.viewportToViewerElementRectangle(s.viewport.imageToViewportRectangle(Ne));q.style.left=ct.x+"px",q.style.top=ct.y+"px",q.style.width=ct.width+"px",q.style.height=ct.height+"px",q.style.display="block"}),v.addEventListener("mouseleave",()=>{q.style.display="none"}),v.addEventListener("click",()=>{const K=parseInt(A,10);Number.isFinite(K)&&He(K)})),v.addEventListener("mouseenter",()=>{v.style.background="rgba(255,255,255,0.05)"}),v.addEventListener("mouseleave",()=>{v.style.background=""})}),m.appendChild(u)}}function Lt(i,m){m.innerHTML="";const{collectors:c,totalScanned:d}=i;if(!c||c.length===0){m.innerHTML="<p>No collector data available.</p>";return}const p=document.createElement("p");p.textContent=`Top collectors (based on ${d.toLocaleString()} transfers analysed):`,p.style.fontSize="12px",p.style.color="#aaa",p.style.marginBottom="8px",m.appendChild(p);const x=document.createElement("ul");x.style.listStyleType="none",x.style.paddingLeft="0";const E=async I=>{try{const l=await(await fetch(`https://api.ensideas.com/ens/resolve/${I}`)).json();if(l!=null&&l.name)return l.name}catch{}return null};c.forEach(I=>{const h=document.createElement("li");h.style.padding="6px 0",h.style.borderBottom="1px solid #444",h.style.cursor="pointer";const l=`${I.address.substring(0,6)}â¦${I.address.substring(I.address.length-4)}`;h.innerHTML=`<span class="collector-name">${l}</span> (<strong>${I.count}</strong>)`,E(I.address).then(u=>{u&&(h.querySelector(".collector-name").textContent=u)}),h.addEventListener("click",()=>{Bt(I,m)}),x.appendChild(h)}),m.appendChild(x)}async function Bt(i,m){const{address:c,tokens:d}=i;s.viewport.goHome();const p=d.map(l=>parseInt(l,10)).filter(l=>Number.isFinite(l));C=new Set(p),rt(p),ze(),m.innerHTML="";const x=document.createElement("button");x.textContent="â Back to collectors",x.style.marginBottom="8px",x.addEventListener("click",()=>{ht(),Lt({collectors:$.collectors,totalScanned:$.totalScanned},m)}),m.appendChild(x);const E=document.createElement("h3");if(E.textContent=`Tokens owned by ${c.substring(0,6)}â¦${c.slice(-4)}`,E.style.fontSize="14px",E.style.margin="8px 0",m.appendChild(E),p.length===0){m.appendChild(document.createTextNode("No tokens found."));return}let I={};try{const{results:l}=await N.getObjects(p.map(u=>u.toString()));l.forEach(u=>{u&&(I[u.objectID]=u.name)})}catch{}const h=document.createElement("ul");h.style.listStyleType="none",h.style.paddingLeft="0",p.forEach(l=>{const u=document.createElement("li");u.style.padding="6px 0",u.style.borderBottom="1px solid #444";const g=I[l]||`Song #${l}`,v=`https://songadaygallery.blob.core.windows.net/dzi/${l}.gif`;u.innerHTML=`<div style="display:flex;gap:10px;align-items:center;">
                <img src="${v}" style="width:32px;height:32px;object-fit:cover;border-radius:4px;background:#222;" />
                <span>${g}</span>
            </div>`,u.addEventListener("mouseenter",()=>{const O=(l-1)%z,F=Math.floor((l-1)/z),T=new OpenSeadragon.Rect(O*G,F*X,G,X),A=1.5,le=T.width*(A-1)/2,he=T.height*(A-1)/2,pe=new OpenSeadragon.Rect(T.x-le,T.y-he,T.width*A,T.height*A),oe=s.viewport.imageToViewportRectangle(pe);s.viewport.fitBounds(oe,!1);const ue=s.viewport.viewportToViewerElementRectangle(s.viewport.imageToViewportRectangle(T));q.style.left=`${ue.x}px`,q.style.top=`${ue.y}px`,q.style.width=`${ue.width}px`,q.style.height=`${ue.height}px`,q.style.display="block"}),u.addEventListener("mouseleave",()=>{q.style.display="none"}),u.addEventListener("click",()=>He(l)),h.appendChild(u)}),m.appendChild(h)}Rt().catch(i=>console.error("Early initOpenSea error",i));function Ft(i){var m,c,d,p,x,E;return((m=i==null?void 0:i.nft)==null?void 0:m.identifier)??((c=i==null?void 0:i.asset)==null?void 0:c.token_id)??((E=(x=(p=(d=i==null?void 0:i.protocol_data)==null?void 0:d.parameters)==null?void 0:p.offer)==null?void 0:x[0])==null?void 0:E.identifierOrCriteria)??null}function Ht(){_.forEach(i=>i.remove()),_.clear()}function Dt(i){const m=s.viewport.imageToViewportRectangle(i.rect),c=s.viewport.viewportToViewerElementRectangle(m),d=document.createElement("div");return d.style.position="absolute",d.style.background="rgba(0,0,0,0.6)",d.style.pointerEvents="none",d.style.zIndex="1000",d.style.left=c.x+"px",d.style.top=c.y+"px",d.style.width=c.width+"px",d.style.height=c.height+"px",s.element.appendChild(d),d}function ze(){if(!C)return;_.forEach((c,d)=>{if(!C.has(d)){c.remove(),_.delete(d);return}});const i=ut(),m=new Set(i.map(c=>c.id));_.forEach((c,d)=>{(!m.has(d)||C.has(d))&&(c.remove(),_.delete(d))}),i.forEach(c=>{if(C.has(c.id))return;const d=_.get(c.id),p=s.viewport.imageToViewportRectangle(c.rect),x=s.viewport.viewportToViewerElementRectangle(p);if(d)d.style.left=x.x+"px",d.style.top=x.y+"px",d.style.width=x.width+"px",d.style.height=x.height+"px";else{const E=Dt(c);_.set(c.id,E)}})}function ht(){C=null,nt(),Ht()}function jt(){ft.forEach(i=>i.remove()),ft.clear()}function zt(i){jt(),Array.from(new Set(i.map(c=>parseInt(c,10)).filter(c=>Number.isFinite(c)&&c>=1&&c<=5852))).forEach(c=>{const d=bt(c);ft.set(c,d)})}})();
